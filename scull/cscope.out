cscope 15 $HOME/example/driver/examples/scull               0000060257
	@access.c

20 
	~<löux/kî√l.h
>

21 
	~<löux/moduÀ.h
>

22 
	~<löux/¶ab.h
>

23 
	~<löux/fs.h
>

24 
	~<löux/î∫o.h
>

25 
	~<löux/ty≥s.h
>

26 
	~<löux/f˙é.h
>

27 
	~<löux/cdev.h
>

28 
	~<löux/ây.h
>

29 
	~<asm/©omic.h
>

30 
	~<löux/li°.h
>

32 
	~"scuŒ.h
"

34 
dev_t
 
	gscuŒ_a_fú°dev
;

49 
scuŒ_dev
 
	gscuŒ_s_devi˚
;

50 
©omic_t
 
	gscuŒ_s_avaûabÀ
 = 
ATOMIC_INIT
(1);

52 
	$scuŒ_s_›í
(
öode
 *öode, 
fûe
 *
fûp
)

54 
scuŒ_dev
 *
dev
 = &
scuŒ_s_devi˚
;

56 i‡(! 
	`©omic_dec_™d_ã°
 (&
scuŒ_s_avaûabÀ
)) {

57 
	`©omic_öc
(&
scuŒ_s_avaûabÀ
);

58  -
EBUSY
;

62 i‡–(
fûp
->
f_Êags
 & 
O_ACCMODE
Ë=
O_WRONLY
)

63 
	`scuŒ_åim
(
dev
);

64 
fûp
->
¥iv©e_d©a
 = 
dev
;

66 
	}
}

68 
	$scuŒ_s_ªÀa£
(
öode
 *öode, 
fûe
 *
fûp
)

70 
	`©omic_öc
(&
scuŒ_s_avaûabÀ
);

72 
	}
}

78 
fûe_›î©i⁄s
 
	gscuŒ_¢gl_f›s
 = {

79 .
ow√r
 = 
THIS_MODULE
,

80 .
	gŒ£ek
 = 
scuŒ_Œ£ek
,

81 .
	gªad
 = 
scuŒ_ªad
,

82 .
	gwrôe
 = 
scuŒ_wrôe
,

83 .
	gio˘l
 = 
scuŒ_io˘l
,

84 .
	g›í
 = 
scuŒ_s_›í
,

85 .
	gªÀa£
 = 
scuŒ_s_ªÀa£
,

95 
scuŒ_dev
 
	gscuŒ_u_devi˚
;

96 
	gscuŒ_u_cou¡
;

97 
uid_t
 
	gscuŒ_u_ow√r
;

98 
•ölock_t
 
	gscuŒ_u_lock
 = 
SPIN_LOCK_UNLOCKED
;

100 
	$scuŒ_u_›í
(
öode
 *öode, 
fûe
 *
fûp
)

102 
scuŒ_dev
 *
dev
 = &
scuŒ_u_devi˚
;

104 
	`•ö_lock
(&
scuŒ_u_lock
);

105 i‡(
scuŒ_u_cou¡
 &&

106 (
scuŒ_u_ow√r
 !
cuºít
->
uid
) &&

107 (
scuŒ_u_ow√r
 !
cuºít
->
euid
) &&

108 !
	`ˇ∑bÀ
(
CAP_DAC_OVERRIDE
)) {

109 
	`•ö_u∆ock
(&
scuŒ_u_lock
);

110  -
EBUSY
;

113 i‡(
scuŒ_u_cou¡
 == 0)

114 
scuŒ_u_ow√r
 = 
cuºít
->
uid
;

116 
scuŒ_u_cou¡
++;

117 
	`•ö_u∆ock
(&
scuŒ_u_lock
);

121 i‡((
fûp
->
f_Êags
 & 
O_ACCMODE
Ë=
O_WRONLY
)

122 
	`scuŒ_åim
(
dev
);

123 
fûp
->
¥iv©e_d©a
 = 
dev
;

125 
	}
}

127 
	$scuŒ_u_ªÀa£
(
öode
 *öode, 
fûe
 *
fûp
)

129 
	`•ö_lock
(&
scuŒ_u_lock
);

130 
scuŒ_u_cou¡
--;

131 
	`•ö_u∆ock
(&
scuŒ_u_lock
);

133 
	}
}

140 
fûe_›î©i⁄s
 
	gscuŒ_u£r_f›s
 = {

141 .
ow√r
 = 
THIS_MODULE
,

142 .
	gŒ£ek
 = 
scuŒ_Œ£ek
,

143 .
	gªad
 = 
scuŒ_ªad
,

144 .
	gwrôe
 = 
scuŒ_wrôe
,

145 .
	gio˘l
 = 
scuŒ_io˘l
,

146 .
	g›í
 = 
scuŒ_u_›í
,

147 .
	gªÀa£
 = 
scuŒ_u_ªÀa£
,

156 
scuŒ_dev
 
	gscuŒ_w_devi˚
;

157 
	gscuŒ_w_cou¡
;

158 
uid_t
 
	gscuŒ_w_ow√r
;

159 
DECLARE_WAIT_QUEUE_HEAD
(
scuŒ_w_waô
);

160 
•ölock_t
 
	gscuŒ_w_lock
 = 
SPIN_LOCK_UNLOCKED
;

162 
ölöe
 
	$scuŒ_w_avaûabÀ
()

164  
scuŒ_w_cou¡
 == 0 ||

165 
scuŒ_w_ow√r
 =
cuºít
->
uid
 ||

166 
scuŒ_w_ow√r
 =
cuºít
->
euid
 ||

167 
	`ˇ∑bÀ
(
CAP_DAC_OVERRIDE
);

168 
	}
}

171 
	$scuŒ_w_›í
(
öode
 *öode, 
fûe
 *
fûp
)

173 
scuŒ_dev
 *
dev
 = &
scuŒ_w_devi˚
;

175 
	`•ö_lock
(&
scuŒ_w_lock
);

176 ! 
	`scuŒ_w_avaûabÀ
()) {

177 
	`•ö_u∆ock
(&
scuŒ_w_lock
);

178 i‡(
fûp
->
f_Êags
 & 
O_NONBLOCK
Ë -
EAGAIN
;

179 i‡(
	`waô_evít_öãºu±ibÀ
 (
scuŒ_w_waô
, 
	`scuŒ_w_avaûabÀ
()))

180  -
ERESTARTSYS
;

181 
	`•ö_lock
(&
scuŒ_w_lock
);

183 i‡(
scuŒ_w_cou¡
 == 0)

184 
scuŒ_w_ow√r
 = 
cuºít
->
uid
;

185 
scuŒ_w_cou¡
++;

186 
	`•ö_u∆ock
(&
scuŒ_w_lock
);

189 i‡((
fûp
->
f_Êags
 & 
O_ACCMODE
Ë=
O_WRONLY
)

190 
	`scuŒ_åim
(
dev
);

191 
fûp
->
¥iv©e_d©a
 = 
dev
;

193 
	}
}

195 
	$scuŒ_w_ªÀa£
(
öode
 *öode, 
fûe
 *
fûp
)

197 
ãmp
;

199 
	`•ö_lock
(&
scuŒ_w_lock
);

200 
scuŒ_w_cou¡
--;

201 
ãmp
 = 
scuŒ_w_cou¡
;

202 
	`•ö_u∆ock
(&
scuŒ_w_lock
);

204 i‡(
ãmp
 == 0)

205 
	`wake_up_öãºu±ibÀ_sync
(&
scuŒ_w_waô
);

207 
	}
}

213 
fûe_›î©i⁄s
 
	gscuŒ_wu§_f›s
 = {

214 .
ow√r
 = 
THIS_MODULE
,

215 .
	gŒ£ek
 = 
scuŒ_Œ£ek
,

216 .
	gªad
 = 
scuŒ_ªad
,

217 .
	gwrôe
 = 
scuŒ_wrôe
,

218 .
	gio˘l
 = 
scuŒ_io˘l
,

219 .
	g›í
 = 
scuŒ_w_›í
,

220 .
	gªÀa£
 = 
scuŒ_w_ªÀa£
,

231 
	sscuŒ_li°ôem
 {

232 
scuŒ_dev
 
	mdevi˚
;

233 
dev_t
 
	mkey
;

234 
li°_hód
 
	mli°
;

239 
LIST_HEAD
(
scuŒ_c_li°
);

240 
•ölock_t
 
	gscuŒ_c_lock
 = 
SPIN_LOCK_UNLOCKED
;

243 
scuŒ_dev
 
	gscuŒ_c_devi˚
;

246 
scuŒ_dev
 *
	$scuŒ_c_lookf‹_devi˚
(
dev_t
 
key
)

248 
scuŒ_li°ôem
 *
Õå
;

250 
	`li°_f‹_óch_íåy
(
Õå
, &
scuŒ_c_li°
, 
li°
) {

251 i‡(
Õå
->
key
 == key)

252  &(
Õå
->
devi˚
);

256 
Õå
 = 
	`kmÆloc
((
scuŒ_li°ôem
), 
GFP_KERNEL
);

257 i‡(!
Õå
)

258  
NULL
;

261 
	`mem£t
(
Õå
, 0, (
scuŒ_li°ôem
));

262 
Õå
->
key
 = key;

263 
	`scuŒ_åim
(&(
Õå
->
devi˚
));

264 
	`öô_MUTEX
(&(
Õå
->
devi˚
.
£m
));

267 
	`li°_add
(&
Õå
->
li°
, &
scuŒ_c_li°
);

269  &(
Õå
->
devi˚
);

270 
	}
}

272 
	$scuŒ_c_›í
(
öode
 *öode, 
fûe
 *
fûp
)

274 
scuŒ_dev
 *
dev
;

275 
dev_t
 
key
;

277 i‡(!
cuºít
->
sig«l
->
ây
) {

278 
	`PDEBUG
("Pro˚s†\"%s\" ha†nÿ˘»ây\n", 
cuºít
->
comm
);

279  -
EINVAL
;

281 
key
 = 
	`ây_devnum
(
cuºít
->
sig«l
->
ây
);

284 
	`•ö_lock
(&
scuŒ_c_lock
);

285 
dev
 = 
	`scuŒ_c_lookf‹_devi˚
(
key
);

286 
	`•ö_u∆ock
(&
scuŒ_c_lock
);

288 i‡(!
dev
)

289  -
ENOMEM
;

292 i‡–(
fûp
->
f_Êags
 & 
O_ACCMODE
Ë=
O_WRONLY
)

293 
	`scuŒ_åim
(
dev
);

294 
fûp
->
¥iv©e_d©a
 = 
dev
;

296 
	}
}

298 
	$scuŒ_c_ªÀa£
(
öode
 *öode, 
fûe
 *
fûp
)

305 
	}
}

312 
fûe_›î©i⁄s
 
	gscuŒ_¥iv_f›s
 = {

313 .
ow√r
 = 
THIS_MODULE
,

314 .
	gŒ£ek
 = 
scuŒ_Œ£ek
,

315 .
	gªad
 = 
scuŒ_ªad
,

316 .
	gwrôe
 = 
scuŒ_wrôe
,

317 .
	gio˘l
 = 
scuŒ_io˘l
,

318 .
	g›í
 = 
scuŒ_c_›í
,

319 .
	gªÀa£
 = 
scuŒ_c_ªÀa£
,

327 
	sscuŒ_adev_öfo
 {

328 *
	m«me
;

329 
scuŒ_dev
 *
	mscuŒdev
;

330 
fûe_›î©i⁄s
 *
	mf›s
;

331 } 
	gscuŒ_ac˚ss_devs
[] = {

332 { "scuŒsögÀ", &
scuŒ_s_devi˚
, &
scuŒ_¢gl_f›s
 },

333 { "scuŒuid", &
scuŒ_u_devi˚
, &
scuŒ_u£r_f›s
 },

334 { "scuŒwuid", &
scuŒ_w_devi˚
, &
scuŒ_wu§_f›s
 },

335 { "suŒ¥iv", &
scuŒ_c_devi˚
, &
scuŒ_¥iv_f›s
 }

337 
	#SCULL_N_ADEVS
 4

	)

342 
	$scuŒ_ac˚ss_£tup
 (
dev_t
 
devno
, 
scuŒ_adev_öfo
 *
devöfo
)

344 
scuŒ_dev
 *
dev
 = 
devöfo
->
scuŒdev
;

345 
îr
;

348 
dev
->
qu™tum
 = 
scuŒ_qu™tum
;

349 
dev
->
q£t
 = 
scuŒ_q£t
;

350 
	`öô_MUTEX
(&
dev
->
£m
);

353 
	`cdev_öô
(&
dev
->
cdev
, 
devöfo
->
f›s
);

354 
	`kobje˘_£t_«me
(&
dev
->
cdev
.
kobj
, 
devöfo
->
«me
);

355 
dev
->
cdev
.
ow√r
 = 
THIS_MODULE
;

356 
îr
 = 
	`cdev_add
 (&
dev
->
cdev
, 
devno
, 1);

358 i‡(
îr
) {

359 
	`¥ötk
(
KERN_NOTICE
 "Eº‹ %dáddög %s\n", 
îr
, 
devöfo
->
«me
);

360 
	`kobje˘_put
(&
dev
->
cdev
.
kobj
);

362 
	`¥ötk
(
KERN_NOTICE
 "%†ªgi°îedáà%x\n", 
devöfo
->
«me
, 
devno
);

363 
	}
}

366 
	$scuŒ_ac˚ss_öô
(
dev_t
 
fú°dev
)

368 
ªsu…
, 
i
;

371 
ªsu…
 = 
	`ªgi°î_chrdev_ªgi⁄
 (
fú°dev
, 
SCULL_N_ADEVS
, "sculla");

372 i‡(
ªsu…
 < 0) {

373 
	`¥ötk
(
KERN_WARNING
 "sculla: deviceÇumberÑegistration failed\n");

376 
scuŒ_a_fú°dev
 = 
fú°dev
;

379 
i
 = 0; i < 
SCULL_N_ADEVS
; i++)

380 
	`scuŒ_ac˚ss_£tup
 (
fú°dev
 + 
i
, 
scuŒ_ac˚ss_devs
 + i);

381  
SCULL_N_ADEVS
;

382 
	}
}

388 
	$scuŒ_ac˚ss_˛ónup
()

390 
scuŒ_li°ôem
 *
Õå
, *
√xt
;

391 
i
;

394 
i
 = 0; i < 
SCULL_N_ADEVS
; i++) {

395 
scuŒ_dev
 *
dev
 = 
scuŒ_ac˚ss_devs
[
i
].
scuŒdev
;

396 
	`cdev_dñ
(&
dev
->
cdev
);

397 
	`scuŒ_åim
(
scuŒ_ac˚ss_devs
[
i
].
scuŒdev
);

401 
	`li°_f‹_óch_íåy_ß„
(
Õå
, 
√xt
, &
scuŒ_c_li°
, 
li°
) {

402 
	`li°_dñ
(&
Õå
->
li°
);

403 
	`scuŒ_åim
(&(
Õå
->
devi˚
));

404 
	`k‰ì
(
Õå
);

408 
	`uƒegi°î_chrdev_ªgi⁄
(
scuŒ_a_fú°dev
, 
SCULL_N_ADEVS
);

410 
	}
}

	@main.c

17 
	~<löux/c⁄fig.h
>

18 
	~<löux/moduÀ.h
>

19 
	~<löux/moduÀ∑øm.h
>

20 
	~<löux/öô.h
>

22 
	~<löux/kî√l.h
>

23 
	~<löux/¶ab.h
>

24 
	~<löux/fs.h
>

25 
	~<löux/î∫o.h
>

26 
	~<löux/ty≥s.h
>

27 
	~<löux/¥oc_fs.h
>

28 
	~<löux/f˙é.h
>

29 
	~<löux/£q_fûe.h
>

30 
	~<löux/cdev.h
>

32 
	~<asm/sy°em.h
>

33 
	~<asm/uac˚ss.h
>

35 
	~"scuŒ.h
"

41 
	gscuŒ_maj‹
 = 
SCULL_MAJOR
;

42 
	gscuŒ_mö‹
 = 0;

43 
	gscuŒ_ƒ_devs
 = 
SCULL_NR_DEVS
;

44 
	gscuŒ_qu™tum
 = 
SCULL_QUANTUM
;

45 
	gscuŒ_q£t
 = 
SCULL_QSET
;

47 
moduÀ_∑øm
(
scuŒ_maj‹
, , 
S_IRUGO
);

48 
moduÀ_∑øm
(
scuŒ_mö‹
, , 
S_IRUGO
);

49 
moduÀ_∑øm
(
scuŒ_ƒ_devs
, , 
S_IRUGO
);

50 
moduÀ_∑øm
(
scuŒ_qu™tum
, , 
S_IRUGO
);

51 
moduÀ_∑øm
(
scuŒ_q£t
, , 
S_IRUGO
);

53 
MODULE_AUTHOR
("Alessandro Rubini, Jonathan Corbet");

54 
MODULE_LICENSE
("Dual BSD/GPL");

56 
scuŒ_dev
 *
	gscuŒ_devi˚s
;

63 
	$scuŒ_åim
(
scuŒ_dev
 *
dev
)

65 
scuŒ_q£t
 *
√xt
, *
d±r
;

66 
q£t
 = 
dev
->qset;

67 
i
;

69 
d±r
 = 
dev
->
d©a
; d±r; d±∏
√xt
) {

70 i‡(
d±r
->
d©a
) {

71 
i
 = 0; i < 
q£t
; i++)

72 
	`k‰ì
(
d±r
->
d©a
[
i
]);

73 
	`k‰ì
(
d±r
->
d©a
);

74 
d±r
->
d©a
 = 
NULL
;

76 
√xt
 = 
d±r
->next;

77 
	`k‰ì
(
d±r
);

79 
dev
->
size
 = 0;

80 
dev
->
qu™tum
 = 
scuŒ_qu™tum
;

81 
dev
->
q£t
 = 
scuŒ_q£t
;

82 
dev
->
d©a
 = 
NULL
;

84 
	}
}

85 #ifde‡
SCULL_DEBUG


90 
	$scuŒ_ªad_¥ocmem
(*
buf
, **
°¨t
, 
off_t
 
off£t
,

91 
cou¡
, *
eof
, *
d©a
)

93 
i
, 
j
, 
Àn
 = 0;

94 
limô
 = 
cou¡
 - 80;

96 
i
 = 0; i < 
scuŒ_ƒ_devs
 && 
Àn
 <
limô
; i++) {

97 
scuŒ_dev
 *
d
 = &
scuŒ_devi˚s
[
i
];

98 
scuŒ_q£t
 *
qs
 = 
d
->
d©a
;

99 i‡(
	`down_öãºu±ibÀ
(&
d
->
£m
))

100  -
ERESTARTSYS
;

101 
Àn
 +
	`•rötf
(
buf
+len,"\nDevice %i: qset %i, q %i, sz %li\n",

102 
i
, 
d
->
q£t
, d->
qu™tum
, d->
size
);

103 ; 
qs
 && 
Àn
 <
limô
; q†qs->
√xt
) {

104 
Àn
 +
	`•rötf
(
buf
 +Üen, " itemát %p, qsetát %p\n",

105 
qs
, qs->
d©a
);

106 i‡(
qs
->
d©a
 && !qs->
√xt
)

107 
j
 = 0; j < 
d
->
q£t
; j++) {

108 i‡(
qs
->
d©a
[
j
])

109 
Àn
 +
	`•rötf
(
buf
 +Üen,

111 
j
, 
qs
->
d©a
[j]);

114 
	`up
(&
scuŒ_devi˚s
[
i
].
£m
);

116 *
eof
 = 1;

117  
Àn
;

118 
	}
}

130 *
	$scuŒ_£q_°¨t
(
£q_fûe
 *
s
, 
loff_t
 *
pos
)

132 i‡(*
pos
 >
scuŒ_ƒ_devs
)

133  
NULL
;

134  
scuŒ_devi˚s
 + *
pos
;

135 
	}
}

137 *
	$scuŒ_£q_√xt
(
£q_fûe
 *
s
, *
v
, 
loff_t
 *
pos
)

139 (*
pos
)++;

140 i‡(*
pos
 >
scuŒ_ƒ_devs
)

141  
NULL
;

142  
scuŒ_devi˚s
 + *
pos
;

143 
	}
}

145 
	$scuŒ_£q_°›
(
£q_fûe
 *
s
, *
v
)

148 
	}
}

150 
	$scuŒ_£q_show
(
£q_fûe
 *
s
, *
v
)

152 
scuŒ_dev
 *
dev
 = (scuŒ_dev *Ë
v
;

153 
scuŒ_q£t
 *
d
;

154 
i
;

156 i‡(
	`down_öãºu±ibÀ
(&
dev
->
£m
))

157  -
ERESTARTSYS
;

158 
	`£q_¥ötf
(
s
, "\nDevice %i: qset %i, q %i, sz %li\n",

159 (Ë(
dev
 - 
scuŒ_devi˚s
), dev->
q£t
,

160 
dev
->
qu™tum
, dev->
size
);

161 
d
 = 
dev
->
d©a
; d; d = d->
√xt
) {

162 
	`£q_¥ötf
(
s
, " iãmáà%p, q£à© %p\n", 
d
, d->
d©a
);

163 i‡(
d
->
d©a
 && !d->
√xt
)

164 
i
 = 0; i < 
dev
->
q£t
; i++) {

165 i‡(
d
->
d©a
[
i
])

166 
	`£q_¥ötf
(
s
, " % 4i: %8p\n",

167 
i
, 
d
->
d©a
[i]);

170 
	`up
(&
dev
->
£m
);

172 
	}
}

177 
£q_›î©i⁄s
 
	gscuŒ_£q_›s
 = {

178 .
°¨t
 = 
scuŒ_£q_°¨t
,

179 .
	g√xt
 = 
scuŒ_£q_√xt
,

180 .
	g°›
 = 
scuŒ_£q_°›
,

181 .
	gshow
 = 
scuŒ_£q_show


188 
	$scuŒ_¥oc_›í
(
öode
 *öode, 
fûe
 *file)

190  
	`£q_›í
(
fûe
, &
scuŒ_£q_›s
);

191 
	}
}

196 
fûe_›î©i⁄s
 
	gscuŒ_¥oc_›s
 = {

197 .
ow√r
 = 
THIS_MODULE
,

198 .
	g›í
 = 
scuŒ_¥oc_›í
,

199 .
	gªad
 = 
£q_ªad
,

200 .
	gŒ£ek
 = 
£q_l£ek
,

201 .
	gªÀa£
 = 
£q_ªÀa£


209 
	$scuŒ_¸óã_¥oc
()

211 
¥oc_dú_íåy
 *
íåy
;

212 
	`¸óã_¥oc_ªad_íåy
("scullmem", 0 ,

213 
NULL
 , 
scuŒ_ªad_¥ocmem
,

214 
NULL
 );

215 
íåy
 = 
	`¸óã_¥oc_íåy
("scuŒ£q", 0, 
NULL
);

216 i‡(
íåy
)

217 
íåy
->
¥oc_f›s
 = &
scuŒ_¥oc_›s
;

218 
	}
}

220 
	$scuŒ_ªmove_¥oc
()

223 
	`ªmove_¥oc_íåy
("scuŒmem", 
NULL
 );

224 
	`ªmove_¥oc_íåy
("scuŒ£q", 
NULL
);

225 
	}
}

238 
	$scuŒ_›í
(
öode
 *öode, 
fûe
 *
fûp
)

240 
scuŒ_dev
 *
dev
;

242 
dev
 = 
	`c⁄èöî_of
(
öode
->
i_cdev
, 
scuŒ_dev
, 
cdev
);

243 
fûp
->
¥iv©e_d©a
 = 
dev
;

246 i‡–(
fûp
->
f_Êags
 & 
O_ACCMODE
Ë=
O_WRONLY
) {

247 i‡(
	`down_öãºu±ibÀ
(&
dev
->
£m
))

248  -
ERESTARTSYS
;

249 
	`scuŒ_åim
(
dev
);

250 
	`up
(&
dev
->
£m
);

253 
	}
}

255 
	$scuŒ_ªÀa£
(
öode
 *öode, 
fûe
 *
fûp
)

258 
	}
}

262 
scuŒ_q£t
 *
	$scuŒ_fﬁlow
(
scuŒ_dev
 *
dev
, 
n
)

264 
scuŒ_q£t
 *
qs
 = 
dev
->
d©a
;

267 i‡(! 
qs
) {

268 
qs
 = 
dev
->
d©a
 = 
	`kmÆloc
((
scuŒ_q£t
), 
GFP_KERNEL
);

269 i‡(
qs
 =
NULL
)

270  
NULL
;

271 
	`mem£t
(
qs
, 0, (
scuŒ_q£t
));

275 
n
--) {

276 i‡(!
qs
->
√xt
) {

277 
qs
->
√xt
 = 
	`kmÆloc
((
scuŒ_q£t
), 
GFP_KERNEL
);

278 i‡(
qs
->
√xt
 =
NULL
)

279  
NULL
;

280 
	`mem£t
(
qs
->
√xt
, 0, (
scuŒ_q£t
));

282 
qs
 = qs->
√xt
;

285  
qs
;

286 
	}
}

292 
ssize_t
 
	$scuŒ_ªad
(
fûe
 *
fûp
, 
__u£r
 *
buf
, 
size_t
 
cou¡
,

293 
loff_t
 *
f_pos
)

295 
scuŒ_dev
 *
dev
 = 
fûp
->
¥iv©e_d©a
;

296 
scuŒ_q£t
 *
d±r
;

297 
qu™tum
 = 
dev
->qu™tum, 
q£t
 = dev->qset;

298 
ôemsize
 = 
qu™tum
 * 
q£t
;

299 
ôem
, 
s_pos
, 
q_pos
, 
ª°
;

300 
ssize_t
 
ªtvÆ
 = 0;

302 i‡(
	`down_öãºu±ibÀ
(&
dev
->
£m
))

303  -
ERESTARTSYS
;

304 i‡(*
f_pos
 >
dev
->
size
)

305 
out
;

306 i‡(*
f_pos
 + 
cou¡
 > 
dev
->
size
)

307 
cou¡
 = 
dev
->
size
 - *
f_pos
;

310 
ôem
 = ()*
f_pos
 / 
ôemsize
;

311 
ª°
 = ()*
f_pos
 % 
ôemsize
;

312 
s_pos
 = 
ª°
 / 
qu™tum
; 
q_pos
 =Ñest % quantum;

315 
d±r
 = 
	`scuŒ_fﬁlow
(
dev
, 
ôem
);

317 i‡(
d±r
 =
NULL
 || !d±r->
d©a
 || ! d±r->d©a[
s_pos
])

318 
out
;

321 i‡(
cou¡
 > 
qu™tum
 - 
q_pos
)

322 
cou¡
 = 
qu™tum
 - 
q_pos
;

324 i‡(
	`c›y_to_u£r
(
buf
, 
d±r
->
d©a
[
s_pos
] + 
q_pos
, 
cou¡
)) {

325 
ªtvÆ
 = -
EFAULT
;

326 
out
;

328 *
f_pos
 +
cou¡
;

329 
ªtvÆ
 = 
cou¡
;

331 
out
:

332 
	`up
(&
dev
->
£m
);

333  
ªtvÆ
;

334 
	}
}

336 
ssize_t
 
	$scuŒ_wrôe
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
buf
, 
size_t
 
cou¡
,

337 
loff_t
 *
f_pos
)

339 
scuŒ_dev
 *
dev
 = 
fûp
->
¥iv©e_d©a
;

340 
scuŒ_q£t
 *
d±r
;

341 
qu™tum
 = 
dev
->qu™tum, 
q£t
 = dev->qset;

342 
ôemsize
 = 
qu™tum
 * 
q£t
;

343 
ôem
, 
s_pos
, 
q_pos
, 
ª°
;

344 
ssize_t
 
ªtvÆ
 = -
ENOMEM
;

346 i‡(
	`down_öãºu±ibÀ
(&
dev
->
£m
))

347  -
ERESTARTSYS
;

350 
ôem
 = ()*
f_pos
 / 
ôemsize
;

351 
ª°
 = ()*
f_pos
 % 
ôemsize
;

352 
s_pos
 = 
ª°
 / 
qu™tum
; 
q_pos
 =Ñest % quantum;

355 
d±r
 = 
	`scuŒ_fﬁlow
(
dev
, 
ôem
);

356 i‡(
d±r
 =
NULL
)

357 
out
;

358 i‡(!
d±r
->
d©a
) {

359 
d±r
->
d©a
 = 
	`kmÆloc
(
q£t
 * (*), 
GFP_KERNEL
);

360 i‡(!
d±r
->
d©a
)

361 
out
;

362 
	`mem£t
(
d±r
->
d©a
, 0, 
q£t
 * (*));

364 i‡(!
d±r
->
d©a
[
s_pos
]) {

365 
d±r
->
d©a
[
s_pos
] = 
	`kmÆloc
(
qu™tum
, 
GFP_KERNEL
);

366 i‡(!
d±r
->
d©a
[
s_pos
])

367 
out
;

370 i‡(
cou¡
 > 
qu™tum
 - 
q_pos
)

371 
cou¡
 = 
qu™tum
 - 
q_pos
;

373 i‡(
	`c›y_‰om_u£r
(
d±r
->
d©a
[
s_pos
]+
q_pos
, 
buf
, 
cou¡
)) {

374 
ªtvÆ
 = -
EFAULT
;

375 
out
;

377 *
f_pos
 +
cou¡
;

378 
ªtvÆ
 = 
cou¡
;

381 i‡(
dev
->
size
 < *
f_pos
)

382 
dev
->
size
 = *
f_pos
;

384 
out
:

385 
	`up
(&
dev
->
£m
);

386  
ªtvÆ
;

387 
	}
}

393 
	$scuŒ_io˘l
(
öode
 *öode, 
fûe
 *
fûp
,

394 
cmd
, 
¨g
)

397 
îr
 = 0, 
tmp
;

398 
ªtvÆ
 = 0;

404 i‡(
	`_IOC_TYPE
(
cmd
Ë!
SCULL_IOC_MAGIC
Ë -
ENOTTY
;

405 i‡(
	`_IOC_NR
(
cmd
Ë> 
SCULL_IOC_MAXNR
Ë -
ENOTTY
;

413 i‡(
	`_IOC_DIR
(
cmd
Ë& 
_IOC_READ
)

414 
îr
 = !
	`ac˚ss_ok
(
VERIFY_WRITE
, (
__u£r
 *)
¨g
, 
	`_IOC_SIZE
(
cmd
));

415 i‡(
	`_IOC_DIR
(
cmd
Ë& 
_IOC_WRITE
)

416 
îr
 = !
	`ac˚ss_ok
(
VERIFY_READ
, (
__u£r
 *)
¨g
, 
	`_IOC_SIZE
(
cmd
));

417 i‡(
îr
Ë -
EFAULT
;

419 
cmd
) {

421 
SCULL_IOCRESET
:

422 
scuŒ_qu™tum
 = 
SCULL_QUANTUM
;

423 
scuŒ_q£t
 = 
SCULL_QSET
;

426 
SCULL_IOCSQUANTUM
:

427 i‡(! 
	`ˇ∑bÀ
 (
CAP_SYS_ADMIN
))

428  -
EPERM
;

429 
ªtvÆ
 = 
	`__gë_u£r
(
scuŒ_qu™tum
, (
__u£r
 *)
¨g
);

432 
SCULL_IOCTQUANTUM
:

433 i‡(! 
	`ˇ∑bÀ
 (
CAP_SYS_ADMIN
))

434  -
EPERM
;

435 
scuŒ_qu™tum
 = 
¨g
;

438 
SCULL_IOCGQUANTUM
:

439 
ªtvÆ
 = 
	`__put_u£r
(
scuŒ_qu™tum
, (
__u£r
 *)
¨g
);

442 
SCULL_IOCQQUANTUM
:

443  
scuŒ_qu™tum
;

445 
SCULL_IOCXQUANTUM
:

446 i‡(! 
	`ˇ∑bÀ
 (
CAP_SYS_ADMIN
))

447  -
EPERM
;

448 
tmp
 = 
scuŒ_qu™tum
;

449 
ªtvÆ
 = 
	`__gë_u£r
(
scuŒ_qu™tum
, (
__u£r
 *)
¨g
);

450 i‡(
ªtvÆ
 == 0)

451 
ªtvÆ
 = 
	`__put_u£r
(
tmp
, (
__u£r
 *)
¨g
);

454 
SCULL_IOCHQUANTUM
:

455 i‡(! 
	`ˇ∑bÀ
 (
CAP_SYS_ADMIN
))

456  -
EPERM
;

457 
tmp
 = 
scuŒ_qu™tum
;

458 
scuŒ_qu™tum
 = 
¨g
;

459  
tmp
;

461 
SCULL_IOCSQSET
:

462 i‡(! 
	`ˇ∑bÀ
 (
CAP_SYS_ADMIN
))

463  -
EPERM
;

464 
ªtvÆ
 = 
	`__gë_u£r
(
scuŒ_q£t
, (
__u£r
 *)
¨g
);

467 
SCULL_IOCTQSET
:

468 i‡(! 
	`ˇ∑bÀ
 (
CAP_SYS_ADMIN
))

469  -
EPERM
;

470 
scuŒ_q£t
 = 
¨g
;

473 
SCULL_IOCGQSET
:

474 
ªtvÆ
 = 
	`__put_u£r
(
scuŒ_q£t
, (
__u£r
 *)
¨g
);

477 
SCULL_IOCQQSET
:

478  
scuŒ_q£t
;

480 
SCULL_IOCXQSET
:

481 i‡(! 
	`ˇ∑bÀ
 (
CAP_SYS_ADMIN
))

482  -
EPERM
;

483 
tmp
 = 
scuŒ_q£t
;

484 
ªtvÆ
 = 
	`__gë_u£r
(
scuŒ_q£t
, (
__u£r
 *)
¨g
);

485 i‡(
ªtvÆ
 == 0)

486 
ªtvÆ
 = 
	`put_u£r
(
tmp
, (
__u£r
 *)
¨g
);

489 
SCULL_IOCHQSET
:

490 i‡(! 
	`ˇ∑bÀ
 (
CAP_SYS_ADMIN
))

491  -
EPERM
;

492 
tmp
 = 
scuŒ_q£t
;

493 
scuŒ_q£t
 = 
¨g
;

494  
tmp
;

502 
SCULL_P_IOCTSIZE
:

503 
scuŒ_p_buf„r
 = 
¨g
;

506 
SCULL_P_IOCQSIZE
:

507  
scuŒ_p_buf„r
;

511  -
ENOTTY
;

513  
ªtvÆ
;

515 
	}
}

523 
loff_t
 
	$scuŒ_Œ£ek
(
fûe
 *
fûp
, 
loff_t
 
off
, 
whí˚
)

525 
scuŒ_dev
 *
dev
 = 
fûp
->
¥iv©e_d©a
;

526 
loff_t
 
√wpos
;

528 
whí˚
) {

530 
√wpos
 = 
off
;

534 
√wpos
 = 
fûp
->
f_pos
 + 
off
;

538 
√wpos
 = 
dev
->
size
 + 
off
;

542  -
EINVAL
;

544 i‡(
√wpos
 < 0Ë -
EINVAL
;

545 
fûp
->
f_pos
 = 
√wpos
;

546  
√wpos
;

547 
	}
}

551 
fûe_›î©i⁄s
 
	gscuŒ_f›s
 = {

552 .
ow√r
 = 
THIS_MODULE
,

553 .
	gŒ£ek
 = 
scuŒ_Œ£ek
,

554 .
	gªad
 = 
scuŒ_ªad
,

555 .
	gwrôe
 = 
scuŒ_wrôe
,

556 .
	gio˘l
 = 
scuŒ_io˘l
,

557 .
	g›í
 = 
scuŒ_›í
,

558 .
	gªÀa£
 = 
scuŒ_ªÀa£
,

570 
	$scuŒ_˛ónup_moduÀ
()

572 
i
;

573 
dev_t
 
devno
 = 
	`MKDEV
(
scuŒ_maj‹
, 
scuŒ_mö‹
);

576 i‡(
scuŒ_devi˚s
) {

577 
i
 = 0; i < 
scuŒ_ƒ_devs
; i++) {

578 
	`scuŒ_åim
(
scuŒ_devi˚s
 + 
i
);

579 
	`cdev_dñ
(&
scuŒ_devi˚s
[
i
].
cdev
);

581 
	`k‰ì
(
scuŒ_devi˚s
);

584 #ifde‡
SCULL_DEBUG


585 
	`scuŒ_ªmove_¥oc
();

589 
	`uƒegi°î_chrdev_ªgi⁄
(
devno
, 
scuŒ_ƒ_devs
);

592 
	`scuŒ_p_˛ónup
();

593 
	`scuŒ_ac˚ss_˛ónup
();

595 
	}
}

601 
	$scuŒ_£tup_cdev
(
scuŒ_dev
 *
dev
, 
ödex
)

603 
îr
, 
devno
 = 
	`MKDEV
(
scuŒ_maj‹
, 
scuŒ_mö‹
 + 
ödex
);

605 
	`cdev_öô
(&
dev
->
cdev
, &
scuŒ_f›s
);

606 
dev
->
cdev
.
ow√r
 = 
THIS_MODULE
;

607 
dev
->
cdev
.
›s
 = &
scuŒ_f›s
;

608 
îr
 = 
	`cdev_add
 (&
dev
->
cdev
, 
devno
, 1);

610 i‡(
îr
)

611 
	`¥ötk
(
KERN_NOTICE
 "Eº‹ %dáddög scuŒ%d", 
îr
, 
ödex
);

612 
	}
}

615 
	$scuŒ_öô_moduÀ
()

617 
ªsu…
, 
i
;

618 
dev_t
 
dev
 = 0;

624 i‡(
scuŒ_maj‹
) {

625 
dev
 = 
	`MKDEV
(
scuŒ_maj‹
, 
scuŒ_mö‹
);

626 
ªsu…
 = 
	`ªgi°î_chrdev_ªgi⁄
(
dev
, 
scuŒ_ƒ_devs
, "scull");

628 
ªsu…
 = 
	`Æloc_chrdev_ªgi⁄
(&
dev
, 
scuŒ_mö‹
, 
scuŒ_ƒ_devs
,

630 
scuŒ_maj‹
 = 
	`MAJOR
(
dev
);

632 i‡(
ªsu…
 < 0) {

633 
	`¥ötk
(
KERN_WARNING
 "scuŒ: c™'àgë maj‹ %d\n", 
scuŒ_maj‹
);

634  
ªsu…
;

641 
scuŒ_devi˚s
 = 
	`kmÆloc
(
scuŒ_ƒ_devs
 * (
scuŒ_dev
), 
GFP_KERNEL
);

642 i‡(!
scuŒ_devi˚s
) {

643 
ªsu…
 = -
ENOMEM
;

644 
Áû
;

646 
	`mem£t
(
scuŒ_devi˚s
, 0, 
scuŒ_ƒ_devs
 * (
scuŒ_dev
));

649 
i
 = 0; i < 
scuŒ_ƒ_devs
; i++) {

650 
scuŒ_devi˚s
[
i
].
qu™tum
 = 
scuŒ_qu™tum
;

651 
scuŒ_devi˚s
[
i
].
q£t
 = 
scuŒ_q£t
;

652 
	`öô_MUTEX
(&
scuŒ_devi˚s
[
i
].
£m
);

653 
	`scuŒ_£tup_cdev
(&
scuŒ_devi˚s
[
i
], i);

657 
dev
 = 
	`MKDEV
(
scuŒ_maj‹
, 
scuŒ_mö‹
 + 
scuŒ_ƒ_devs
);

658 
dev
 +
	`scuŒ_p_öô
(dev);

659 
dev
 +
	`scuŒ_ac˚ss_öô
(dev);

661 #ifde‡
SCULL_DEBUG


662 
	`scuŒ_¸óã_¥oc
();

667 
Áû
:

668 
	`scuŒ_˛ónup_moduÀ
();

669  
ªsu…
;

670 
	}
}

672 
moduÀ_öô
(
scuŒ_öô_moduÀ
);

673 
moduÀ_exô
(
scuŒ_˛ónup_moduÀ
);

	@pipe.c

17 
	~<löux/moduÀ.h
>

18 
	~<löux/moduÀ∑øm.h
>

20 
	~<löux/kî√l.h
>

21 
	~<löux/¶ab.h
>

22 
	~<löux/fs.h
>

23 
	~<löux/¥oc_fs.h
>

24 
	~<löux/î∫o.h
>

25 
	~<löux/ty≥s.h
>

26 
	~<löux/f˙é.h
>

27 
	~<löux/pﬁl.h
>

28 
	~<löux/cdev.h
>

29 
	~<asm/uac˚ss.h
>

31 
	~"scuŒ.h
"

33 
	sscuŒ_pùe
 {

34 
waô_queue_hód_t
 
	möq
, 
	moutq
;

35 *
	mbuf„r
, *
	míd
;

36 
	mbuf„rsize
;

37 *
	mΩ
, *
	mwp
;

38 
	mƒódîs
, 
	mnwrôîs
;

39 
Ásync_°ru˘
 *
	masync_queue
;

40 
£m≠h‹e
 
	m£m
;

41 
cdev
 
	mcdev
;

45 
	gscuŒ_p_ƒ_devs
 = 
SCULL_P_NR_DEVS
;

46 
	gscuŒ_p_buf„r
 = 
SCULL_P_BUFFER
;

47 
dev_t
 
	gscuŒ_p_devno
;

49 
moduÀ_∑øm
(
scuŒ_p_ƒ_devs
, , 0);

50 
moduÀ_∑øm
(
scuŒ_p_buf„r
, , 0);

52 
scuŒ_pùe
 *
	gscuŒ_p_devi˚s
;

54 
scuŒ_p_Ásync
(
fd
, 
fûe
 *
fûp
, 
mode
);

55 
•a˚‰ì
(
scuŒ_pùe
 *
dev
);

61 
	$scuŒ_p_›í
(
öode
 *öode, 
fûe
 *
fûp
)

63 
scuŒ_pùe
 *
dev
;

65 
dev
 = 
	`c⁄èöî_of
(
öode
->
i_cdev
, 
scuŒ_pùe
, 
cdev
);

66 
fûp
->
¥iv©e_d©a
 = 
dev
;

68 i‡(
	`down_öãºu±ibÀ
(&
dev
->
£m
))

69  -
ERESTARTSYS
;

70 i‡(!
dev
->
buf„r
) {

72 
dev
->
buf„r
 = 
	`kmÆloc
(
scuŒ_p_buf„r
, 
GFP_KERNEL
);

73 i‡(!
dev
->
buf„r
) {

74 
	`up
(&
dev
->
£m
);

75  -
ENOMEM
;

78 
dev
->
buf„rsize
 = 
scuŒ_p_buf„r
;

79 
dev
->
íd
 = dev->
buf„r
 + dev->
buf„rsize
;

80 
dev
->
Ω
 = dev->
wp
 = dev->
buf„r
;

83 i‡(
fûp
->
f_mode
 & 
FMODE_READ
)

84 
dev
->
ƒódîs
++;

85 i‡(
fûp
->
f_mode
 & 
FMODE_WRITE
)

86 
dev
->
nwrôîs
++;

87 
	`up
(&
dev
->
£m
);

89  
	`n⁄£ekabÀ_›í
(
öode
, 
fûp
);

90 
	}
}

94 
	$scuŒ_p_ªÀa£
(
öode
 *öode, 
fûe
 *
fûp
)

96 
scuŒ_pùe
 *
dev
 = 
fûp
->
¥iv©e_d©a
;

99 
	`scuŒ_p_Ásync
(-1, 
fûp
, 0);

100 
	`down
(&
dev
->
£m
);

101 i‡(
fûp
->
f_mode
 & 
FMODE_READ
)

102 
dev
->
ƒódîs
--;

103 i‡(
fûp
->
f_mode
 & 
FMODE_WRITE
)

104 
dev
->
nwrôîs
--;

105 i‡(
dev
->
ƒódîs
 + dev->
nwrôîs
 == 0) {

106 
	`k‰ì
(
dev
->
buf„r
);

107 
dev
->
buf„r
 = 
NULL
;

109 
	`up
(&
dev
->
£m
);

111 
	}
}

118 
ssize_t
 
	$scuŒ_p_ªad
 (
fûe
 *
fûp
, 
__u£r
 *
buf
, 
size_t
 
cou¡
,

119 
loff_t
 *
f_pos
)

121 
scuŒ_pùe
 *
dev
 = 
fûp
->
¥iv©e_d©a
;

123 i‡(
	`down_öãºu±ibÀ
(&
dev
->
£m
))

124  -
ERESTARTSYS
;

126 
dev
->
Ω
 =dev->
wp
) {

127 
	`up
(&
dev
->
£m
);

128 i‡(
fûp
->
f_Êags
 & 
O_NONBLOCK
)

129  -
EAGAIN
;

130 
	`PDEBUG
("\"%s\"Ñódög: goögÅÿ¶ìp\n", 
cuºít
->
comm
);

131 i‡(
	`waô_evít_öãºu±ibÀ
(
dev
->
öq
, (dev->
Ω
 !dev->
wp
)))

132  -
ERESTARTSYS
;

134 i‡(
	`down_öãºu±ibÀ
(&
dev
->
£m
))

135  -
ERESTARTSYS
;

138 i‡(
dev
->
wp
 > dev->
Ω
)

139 
cou¡
 = 
	`mö
(cou¡, (
size_t
)(
dev
->
wp
 - dev->
Ω
));

141 
cou¡
 = 
	`mö
(cou¡, (
size_t
)(
dev
->
íd
 - dev->
Ω
));

142 i‡(
	`c›y_to_u£r
(
buf
, 
dev
->
Ω
, 
cou¡
)) {

143 
	`up
 (&
dev
->
£m
);

144  -
EFAULT
;

146 
dev
->
Ω
 +
cou¡
;

147 i‡(
dev
->
Ω
 =dev->
íd
)

148 
dev
->
Ω
 = dev->
buf„r
;

149 
	`up
 (&
dev
->
£m
);

152 
	`wake_up_öãºu±ibÀ
(&
dev
->
outq
);

153 
	`PDEBUG
("\"%s\" didÑód %lòbyãs\n",
cuºít
->
comm
, ()
cou¡
);

154  
cou¡
;

155 
	}
}

159 
	$scuŒ_gëwrôe•a˚
(
scuŒ_pùe
 *
dev
, 
fûe
 *
fûp
)

161 
	`•a˚‰ì
(
dev
) == 0) {

162 
	`DEFINE_WAIT
(
waô
);

164 
	`up
(&
dev
->
£m
);

165 i‡(
fûp
->
f_Êags
 & 
O_NONBLOCK
)

166  -
EAGAIN
;

167 
	`PDEBUG
("\"%s\" wrôög: goögÅÿ¶ìp\n",
cuºít
->
comm
);

168 
	`¥ï¨e_to_waô
(&
dev
->
outq
, &
waô
, 
TASK_INTERRUPTIBLE
);

169 i‡(
	`•a˚‰ì
(
dev
) == 0)

170 
	`scheduÀ
();

171 
	`föish_waô
(&
dev
->
outq
, &
waô
);

172 i‡(
	`sig«l_≥ndög
(
cuºít
))

173  -
ERESTARTSYS
;

174 i‡(
	`down_öãºu±ibÀ
(&
dev
->
£m
))

175  -
ERESTARTSYS
;

178 
	}
}

181 
	$•a˚‰ì
(
scuŒ_pùe
 *
dev
)

183 i‡(
dev
->
Ω
 =dev->
wp
)

184  
dev
->
buf„rsize
 - 1;

185  ((
dev
->
Ω
 + dev->
buf„rsize
 - dev->
wp
) % dev->buffersize) - 1;

186 
	}
}

188 
ssize_t
 
	$scuŒ_p_wrôe
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
buf
, 
size_t
 
cou¡
,

189 
loff_t
 *
f_pos
)

191 
scuŒ_pùe
 *
dev
 = 
fûp
->
¥iv©e_d©a
;

192 
ªsu…
;

194 i‡(
	`down_öãºu±ibÀ
(&
dev
->
£m
))

195  -
ERESTARTSYS
;

198 
ªsu…
 = 
	`scuŒ_gëwrôe•a˚
(
dev
, 
fûp
);

199 i‡(
ªsu…
)

200  
ªsu…
;

203 
cou¡
 = 
	`mö
(cou¡, (
size_t
)
	`•a˚‰ì
(
dev
));

204 i‡(
dev
->
wp
 >dev->
Ω
)

205 
cou¡
 = 
	`mö
(cou¡, (
size_t
)(
dev
->
íd
 - dev->
wp
));

207 
cou¡
 = 
	`mö
(cou¡, (
size_t
)(
dev
->
Ω
 - dev->
wp
 - 1));

208 
	`PDEBUG
("GoögÅÿac˚± %lòbyã†tÿ%∞‰om %p\n", ()
cou¡
, 
dev
->
wp
, 
buf
);

209 i‡(
	`c›y_‰om_u£r
(
dev
->
wp
, 
buf
, 
cou¡
)) {

210 
	`up
 (&
dev
->
£m
);

211  -
EFAULT
;

213 
dev
->
wp
 +
cou¡
;

214 i‡(
dev
->
wp
 =dev->
íd
)

215 
dev
->
wp
 = dev->
buf„r
;

216 
	`up
(&
dev
->
£m
);

219 
	`wake_up_öãºu±ibÀ
(&
dev
->
öq
);

222 i‡(
dev
->
async_queue
)

223 
	`kûl_Ásync
(&
dev
->
async_queue
, 
SIGIO
, 
POLL_IN
);

224 
	`PDEBUG
("\"%s\" did wrôê%lòbyãs\n",
cuºít
->
comm
, ()
cou¡
);

225  
cou¡
;

226 
	}
}

228 
	$scuŒ_p_pﬁl
(
fûe
 *
fûp
, 
pﬁl_èbÀ
 *
waô
)

230 
scuŒ_pùe
 *
dev
 = 
fûp
->
¥iv©e_d©a
;

231 
mask
 = 0;

238 
	`down
(&
dev
->
£m
);

239 
	`pﬁl_waô
(
fûp
, &
dev
->
öq
, 
waô
);

240 
	`pﬁl_waô
(
fûp
, &
dev
->
outq
, 
waô
);

241 i‡(
dev
->
Ω
 !dev->
wp
)

242 
mask
 |
POLLIN
 | 
POLLRDNORM
;

243 i‡(
	`•a˚‰ì
(
dev
))

244 
mask
 |
POLLOUT
 | 
POLLWRNORM
;

245 
	`up
(&
dev
->
£m
);

246  
mask
;

247 
	}
}

253 
	$scuŒ_p_Ásync
(
fd
, 
fûe
 *
fûp
, 
mode
)

255 
scuŒ_pùe
 *
dev
 = 
fûp
->
¥iv©e_d©a
;

257  
	`Ásync_hñ≥r
(
fd
, 
fûp
, 
mode
, &
dev
->
async_queue
);

258 
	}
}

263 #ifde‡
SCULL_DEBUG


264 
	$scuŒp_¥oc_off£t
(*
buf
, **
°¨t
, 
off_t
 *
off£t
, *
Àn
)

266 i‡(*
off£t
 == 0)

268 i‡(*
off£t
 >*
Àn
) {

269 *
off£t
 -*
Àn
;

270 *
Àn
 = 0;

273 *
°¨t
 = 
buf
 + *
off£t
;

274 *
off£t
 = 0;

276 
	}
}

279 
	$scuŒ_ªad_p_mem
(*
buf
, **
°¨t
, 
off_t
 
off£t
, 
cou¡
,

280 *
eof
, *
d©a
)

282 
i
, 
Àn
;

283 
scuŒ_pùe
 *
p
;

285 
	#LIMIT
 (
PAGE_SIZE
-200Ë

	)

286 *
°¨t
 = 
buf
;

287 
Àn
 = 
	`•rötf
(
buf
, "DeÁu… buf„rsizêi†%i\n", 
scuŒ_p_buf„r
);

288 
i
 = 0; i<
scuŒ_p_ƒ_devs
 && 
Àn
 <
LIMIT
; i++) {

289 
p
 = &
scuŒ_p_devi˚s
[
i
];

290 i‡(
	`down_öãºu±ibÀ
(&
p
->
£m
))

291  -
ERESTARTSYS
;

292 
Àn
 +
	`•rötf
(
buf
+Àn, "\nDevi˚ %i: %p\n", 
i
, 
p
);

294 
Àn
 +
	`•rötf
(
buf
+Àn, " Buf„r: %∞tÿ%∞(%òbyãs)\n", 
p
->
buf„r
,Ö->
íd
,Ö->
buf„rsize
);

295 
Àn
 +
	`•rötf
(
buf
+Àn, "Ñ∞%∞ w∞%p\n", 
p
->
Ω
,Ö->
wp
);

296 
Àn
 +
	`•rötf
(
buf
+Àn, "Ñódî†%ò wrôî†%i\n", 
p
->
ƒódîs
,Ö->
nwrôîs
);

297 
	`up
(&
p
->
£m
);

298 
	`scuŒp_¥oc_off£t
(
buf
, 
°¨t
, &
off£t
, &
Àn
);

300 *
eof
 = (
Àn
 <
LIMIT
);

301  
Àn
;

302 
	}
}

313 
fûe_›î©i⁄s
 
	gscuŒ_pùe_f›s
 = {

314 .
ow√r
 = 
THIS_MODULE
,

315 .
	gŒ£ek
 = 
no_Œ£ek
,

316 .
	gªad
 = 
scuŒ_p_ªad
,

317 .
	gwrôe
 = 
scuŒ_p_wrôe
,

318 .
	gpﬁl
 = 
scuŒ_p_pﬁl
,

319 .
	gio˘l
 = 
scuŒ_io˘l
,

320 .
	g›í
 = 
scuŒ_p_›í
,

321 .
	gªÀa£
 = 
scuŒ_p_ªÀa£
,

322 .
	gÁsync
 = 
scuŒ_p_Ásync
,

329 
	$scuŒ_p_£tup_cdev
(
scuŒ_pùe
 *
dev
, 
ödex
)

331 
îr
, 
devno
 = 
scuŒ_p_devno
 + 
ödex
;

333 
	`cdev_öô
(&
dev
->
cdev
, &
scuŒ_pùe_f›s
);

334 
dev
->
cdev
.
ow√r
 = 
THIS_MODULE
;

335 
îr
 = 
	`cdev_add
 (&
dev
->
cdev
, 
devno
, 1);

337 i‡(
îr
)

338 
	`¥ötk
(
KERN_NOTICE
 "Eº‹ %dáddög scuŒpùe%d", 
îr
, 
ödex
);

339 
	}
}

346 
	$scuŒ_p_öô
(
dev_t
 
fú°dev
)

348 
i
, 
ªsu…
;

350 
ªsu…
 = 
	`ªgi°î_chrdev_ªgi⁄
(
fú°dev
, 
scuŒ_p_ƒ_devs
, "scullp");

351 i‡(
ªsu…
 < 0) {

352 
	`¥ötk
(
KERN_NOTICE
 "U«bÀÅÿgë scuŒ∞ªgi⁄,Éº‹ %d\n", 
ªsu…
);

355 
scuŒ_p_devno
 = 
fú°dev
;

356 
scuŒ_p_devi˚s
 = 
	`kmÆloc
(
scuŒ_p_ƒ_devs
 * (
scuŒ_pùe
), 
GFP_KERNEL
);

357 i‡(
scuŒ_p_devi˚s
 =
NULL
) {

358 
	`uƒegi°î_chrdev_ªgi⁄
(
fú°dev
, 
scuŒ_p_ƒ_devs
);

361 
	`mem£t
(
scuŒ_p_devi˚s
, 0, 
scuŒ_p_ƒ_devs
 * (
scuŒ_pùe
));

362 
i
 = 0; i < 
scuŒ_p_ƒ_devs
; i++) {

363 
	`öô_waôqueue_hód
(&(
scuŒ_p_devi˚s
[
i
].
öq
));

364 
	`öô_waôqueue_hód
(&(
scuŒ_p_devi˚s
[
i
].
outq
));

365 
	`öô_MUTEX
(&
scuŒ_p_devi˚s
[
i
].
£m
);

366 
	`scuŒ_p_£tup_cdev
(
scuŒ_p_devi˚s
 + 
i
, i);

368 #ifde‡
SCULL_DEBUG


369 
	`¸óã_¥oc_ªad_íåy
("scuŒpùe", 0, 
NULL
, 
scuŒ_ªad_p_mem
, NULL);

371  
scuŒ_p_ƒ_devs
;

372 
	}
}

378 
	$scuŒ_p_˛ónup
()

380 
i
;

382 #ifde‡
SCULL_DEBUG


383 
	`ªmove_¥oc_íåy
("scuŒpùe", 
NULL
);

386 i‡(!
scuŒ_p_devi˚s
)

389 
i
 = 0; i < 
scuŒ_p_ƒ_devs
; i++) {

390 
	`cdev_dñ
(&
scuŒ_p_devi˚s
[
i
].
cdev
);

391 
	`k‰ì
(
scuŒ_p_devi˚s
[
i
].
buf„r
);

393 
	`k‰ì
(
scuŒ_p_devi˚s
);

394 
	`uƒegi°î_chrdev_ªgi⁄
(
scuŒ_p_devno
, 
scuŒ_p_ƒ_devs
);

395 
scuŒ_p_devi˚s
 = 
NULL
;

396 
	}
}

	@scull.h

18 #i‚de‡
_SCULL_H_


19 
	#_SCULL_H_


	)

21 
	~<löux/io˘l.h
>

27 #unde‡
PDEBUG


28 #ifde‡
SCULL_DEBUG


29 #ifde‡
__KERNEL__


31 
	#PDEBUG
(
fmt
, 
¨gs
...Ë
	`¥ötk
–
KERN_DEBUG
 "scuŒ: " fmt, ##árgs)

	)

34 
	#PDEBUG
(
fmt
, 
¨gs
...Ë
	`Ârötf
(
°dîr
, fmt, ##árgs)

	)

37 
	#PDEBUG
(
fmt
, 
¨gs
...Ë

	)

40 #unde‡
PDEBUGG


41 
	#PDEBUGG
(
fmt
, 
¨gs
...Ë

	)

43 #i‚de‡
SCULL_MAJOR


44 
	#SCULL_MAJOR
 0

	)

47 #i‚de‡
SCULL_NR_DEVS


48 
	#SCULL_NR_DEVS
 4

	)

51 #i‚de‡
SCULL_P_NR_DEVS


52 
	#SCULL_P_NR_DEVS
 4

	)

64 #i‚de‡
SCULL_QUANTUM


65 
	#SCULL_QUANTUM
 4000

	)

68 #i‚de‡
SCULL_QSET


69 
	#SCULL_QSET
 1000

	)

75 #i‚de‡
SCULL_P_BUFFER


76 
	#SCULL_P_BUFFER
 4000

	)

82 
	sscuŒ_q£t
 {

83 **
	md©a
;

84 
scuŒ_q£t
 *
	m√xt
;

87 
	sscuŒ_dev
 {

88 
scuŒ_q£t
 *
	md©a
;

89 
	mqu™tum
;

90 
	mq£t
;

91 
	msize
;

92 
	mac˚ss_key
;

93 
£m≠h‹e
 
	m£m
;

94 
cdev
 
	mcdev
;

100 
	#TYPE
(
mö‹
Ë(((mö‹Ë>> 4Ë& 0xfË

	)

101 
	#NUM
(
mö‹
Ë((mö‹Ë& 0xfË

	)

107 
scuŒ_maj‹
;

108 
scuŒ_ƒ_devs
;

109 
scuŒ_qu™tum
;

110 
scuŒ_q£t
;

112 
scuŒ_p_buf„r
;

119 
scuŒ_p_öô
(
dev_t
 
dev
);

120 
scuŒ_p_˛ónup
();

121 
scuŒ_ac˚ss_öô
(
dev_t
 
dev
);

122 
scuŒ_ac˚ss_˛ónup
();

124 
scuŒ_åim
(
scuŒ_dev
 *
dev
);

126 
ssize_t
 
scuŒ_ªad
(
fûe
 *
fûp
, 
__u£r
 *
buf
, 
size_t
 
cou¡
,

127 
loff_t
 *
f_pos
);

128 
ssize_t
 
scuŒ_wrôe
(
fûe
 *
fûp
, c⁄° 
__u£r
 *
buf
, 
size_t
 
cou¡
,

129 
loff_t
 *
f_pos
);

130 
loff_t
 
scuŒ_Œ£ek
(
fûe
 *
fûp
,Üoff_à
off
, 
whí˚
);

131 
scuŒ_io˘l
(
öode
 *öode, 
fûe
 *
fûp
,

132 
cmd
, 
¨g
);

140 
	#SCULL_IOC_MAGIC
 'k'

	)

143 
	#SCULL_IOCRESET
 
	`_IO
(
SCULL_IOC_MAGIC
, 0)

	)

153 
	#SCULL_IOCSQUANTUM
 
	`_IOW
(
SCULL_IOC_MAGIC
, 1, )

	)

154 
	#SCULL_IOCSQSET
 
	`_IOW
(
SCULL_IOC_MAGIC
, 2, )

	)

155 
	#SCULL_IOCTQUANTUM
 
	`_IO
(
SCULL_IOC_MAGIC
, 3)

	)

156 
	#SCULL_IOCTQSET
 
	`_IO
(
SCULL_IOC_MAGIC
, 4)

	)

157 
	#SCULL_IOCGQUANTUM
 
	`_IOR
(
SCULL_IOC_MAGIC
, 5, )

	)

158 
	#SCULL_IOCGQSET
 
	`_IOR
(
SCULL_IOC_MAGIC
, 6, )

	)

159 
	#SCULL_IOCQQUANTUM
 
	`_IO
(
SCULL_IOC_MAGIC
, 7)

	)

160 
	#SCULL_IOCQQSET
 
	`_IO
(
SCULL_IOC_MAGIC
, 8)

	)

161 
	#SCULL_IOCXQUANTUM
 
	`_IOWR
(
SCULL_IOC_MAGIC
, 9, )

	)

162 
	#SCULL_IOCXQSET
 
	`_IOWR
(
SCULL_IOC_MAGIC
,10, )

	)

163 
	#SCULL_IOCHQUANTUM
 
	`_IO
(
SCULL_IOC_MAGIC
, 11)

	)

164 
	#SCULL_IOCHQSET
 
	`_IO
(
SCULL_IOC_MAGIC
, 12)

	)

171 
	#SCULL_P_IOCTSIZE
 
	`_IO
(
SCULL_IOC_MAGIC
, 13)

	)

172 
	#SCULL_P_IOCQSIZE
 
	`_IO
(
SCULL_IOC_MAGIC
, 14)

	)

175 
	#SCULL_IOC_MAXNR
 14

	)

	@/usr/include/linux/errno.h

1 #i‚de‡
_LINUX_ERRNO_H


2 
	#_LINUX_ERRNO_H


	)

4 
	~<asm/î∫o.h
>

	@/usr/include/linux/fcntl.h

1 #i‚de‡
_LINUX_FCNTL_H


2 
	#_LINUX_FCNTL_H


	)

4 
	~<asm/f˙é.h
>

6 
	#F_SETLEASE
 (
F_LINUX_SPECIFIC_BASE
 + 0)

	)

7 
	#F_GETLEASE
 (
F_LINUX_SPECIFIC_BASE
 + 1)

	)

13 
	#F_CANCELLK
 (
F_LINUX_SPECIFIC_BASE
 + 5)

	)

16 
	#F_DUPFD_CLOEXEC
 (
F_LINUX_SPECIFIC_BASE
 + 6)

	)

22 
	#F_NOTIFY
 (
F_LINUX_SPECIFIC_BASE
+2)

	)

27 
	#F_SETPIPE_SZ
 (
F_LINUX_SPECIFIC_BASE
 + 7)

	)

28 
	#F_GETPIPE_SZ
 (
F_LINUX_SPECIFIC_BASE
 + 8)

	)

33 
	#DN_ACCESS
 0x00000001

	)

34 
	#DN_MODIFY
 0x00000002

	)

35 
	#DN_CREATE
 0x00000004

	)

36 
	#DN_DELETE
 0x00000008

	)

37 
	#DN_RENAME
 0x00000010

	)

38 
	#DN_ATTRIB
 0x00000020

	)

39 
	#DN_MULTISHOT
 0x80000000

	)

41 
	#AT_FDCWD
 -100

	)

44 
	#AT_SYMLINK_NOFOLLOW
 0x100

	)

45 
	#AT_REMOVEDIR
 0x200

	)

47 
	#AT_SYMLINK_FOLLOW
 0x400

	)

48 
	#AT_NO_AUTOMOUNT
 0x800

	)

49 
	#AT_EMPTY_PATH
 0x1000

	)

	@/usr/include/linux/fs.h

1 #i‚de‡
_LINUX_FS_H


2 
	#_LINUX_FS_H


	)

9 
	~<löux/limôs.h
>

10 
	~<löux/io˘l.h
>

11 
	~<löux/blk_ty≥s.h
>

12 
	~<löux/ty≥s.h
>

25 #unde‡
NR_OPEN


26 
	#INR_OPEN_CUR
 1024

	)

27 
	#INR_OPEN_MAX
 4096

	)

29 
	#BLOCK_SIZE_BITS
 10

	)

30 
	#BLOCK_SIZE
 (1<<
BLOCK_SIZE_BITS
)

	)

32 
	#SEEK_SET
 0

	)

33 
	#SEEK_CUR
 1

	)

34 
	#SEEK_END
 2

	)

35 
	#SEEK_DATA
 3

	)

36 
	#SEEK_HOLE
 4

	)

37 
	#SEEK_MAX
 
SEEK_HOLE


	)

39 
	sf°rim_ønge
 {

40 
__u64
 
	m°¨t
;

41 
__u64
 
	mÀn
;

42 
__u64
 
	mmöÀn
;

46 
	sfûes_°©_°ru˘
 {

47 
	mƒ_fûes
;

48 
	mƒ_‰ì_fûes
;

49 
	mmax_fûes
;

52 
	söodes_°©_t
 {

53 
	mƒ_öodes
;

54 
	mƒ_unu£d
;

55 
	mdummy
[5];

59 
	#NR_FILE
 8192

	)

61 
	#MAY_EXEC
 0x00000001

	)

62 
	#MAY_WRITE
 0x00000002

	)

63 
	#MAY_READ
 0x00000004

	)

64 
	#MAY_APPEND
 0x00000008

	)

65 
	#MAY_ACCESS
 0x00000010

	)

66 
	#MAY_OPEN
 0x00000020

	)

67 
	#MAY_CHDIR
 0x00000040

	)

69 
	#MAY_NOT_BLOCK
 0x00000080

	)

77 
	#FMODE_READ
 ((
fmode_t
)0x1)

	)

79 
	#FMODE_WRITE
 ((
fmode_t
)0x2)

	)

81 
	#FMODE_LSEEK
 ((
fmode_t
)0x4)

	)

83 
	#FMODE_PREAD
 ((
fmode_t
)0x8)

	)

85 
	#FMODE_PWRITE
 ((
fmode_t
)0x10)

	)

87 
	#FMODE_EXEC
 ((
fmode_t
)0x20)

	)

89 
	#FMODE_NDELAY
 ((
fmode_t
)0x40)

	)

91 
	#FMODE_EXCL
 ((
fmode_t
)0x80)

	)

94 
	#FMODE_WRITE_IOCTL
 ((
fmode_t
)0x100)

	)

102 
	#FMODE_NOCMTIME
 ((
fmode_t
)0x800)

	)

105 
	#FMODE_RANDOM
 ((
fmode_t
)0x1000)

	)

108 
	#FMODE_UNSIGNED_OFFSET
 ((
fmode_t
)0x2000)

	)

111 
	#FMODE_PATH
 ((
fmode_t
)0x4000)

	)

114 
	#FMODE_NONOTIFY
 ((
fmode_t
)0x1000000)

	)

158 
	#RW_MASK
 
REQ_WRITE


	)

159 
	#RWA_MASK
 
REQ_RAHEAD


	)

161 
	#READ
 0

	)

162 
	#WRITE
 
RW_MASK


	)

163 
	#READA
 
RWA_MASK


	)

165 
	#READ_SYNC
 (
READ
 | 
REQ_SYNC
)

	)

166 
	#WRITE_SYNC
 (
WRITE
 | 
REQ_SYNC
 | 
REQ_NOIDLE
)

	)

167 
	#WRITE_ODIRECT
 (
WRITE
 | 
REQ_SYNC
)

	)

168 
	#WRITE_FLUSH
 (
WRITE
 | 
REQ_SYNC
 | 
REQ_NOIDLE
 | 
REQ_FLUSH
)

	)

169 
	#WRITE_FUA
 (
WRITE
 | 
REQ_SYNC
 | 
REQ_NOIDLE
 | 
REQ_FUA
)

	)

170 
	#WRITE_FLUSH_FUA
 (
WRITE
 | 
REQ_SYNC
 | 
REQ_NOIDLE
 | 
REQ_FLUSH
 | 
REQ_FUA
)

	)

172 
	#SEL_IN
 1

	)

173 
	#SEL_OUT
 2

	)

174 
	#SEL_EX
 4

	)

177 
	#FS_REQUIRES_DEV
 1

	)

178 
	#FS_BINARY_MOUNTDATA
 2

	)

179 
	#FS_HAS_SUBTYPE
 4

	)

180 
	#FS_REVAL_DOT
 16384

	)

181 
	#FS_RENAME_DOES_D_MOVE
 32768

	)

188 
	#MS_RDONLY
 1

	)

189 
	#MS_NOSUID
 2

	)

190 
	#MS_NODEV
 4

	)

191 
	#MS_NOEXEC
 8

	)

192 
	#MS_SYNCHRONOUS
 16

	)

193 
	#MS_REMOUNT
 32

	)

194 
	#MS_MANDLOCK
 64

	)

195 
	#MS_DIRSYNC
 128

	)

196 
	#MS_NOATIME
 1024

	)

197 
	#MS_NODIRATIME
 2048

	)

198 
	#MS_BIND
 4096

	)

199 
	#MS_MOVE
 8192

	)

200 
	#MS_REC
 16384

	)

201 
	#MS_VERBOSE
 32768

	)

203 
	#MS_SILENT
 32768

	)

204 
	#MS_POSIXACL
 (1<<16Ë

	)

205 
	#MS_UNBINDABLE
 (1<<17Ë

	)

206 
	#MS_PRIVATE
 (1<<18Ë

	)

207 
	#MS_SLAVE
 (1<<19Ë

	)

208 
	#MS_SHARED
 (1<<20Ë

	)

209 
	#MS_RELATIME
 (1<<21Ë

	)

210 
	#MS_KERNMOUNT
 (1<<22Ë

	)

211 
	#MS_I_VERSION
 (1<<23Ë

	)

212 
	#MS_STRICTATIME
 (1<<24Ë

	)

213 
	#MS_NOSEC
 (1<<28)

	)

214 
	#MS_BORN
 (1<<29)

	)

215 
	#MS_ACTIVE
 (1<<30)

	)

216 
	#MS_NOUSER
 (1<<31)

	)

221 
	#MS_RMT_MASK
 (
MS_RDONLY
|
MS_SYNCHRONOUS
|
MS_MANDLOCK
|
MS_I_VERSION
)

	)

226 
	#MS_MGC_VAL
 0xC0ED0000

	)

227 
	#MS_MGC_MSK
 0xffff0000

	)

231 
	#S_SYNC
 1

	)

232 
	#S_NOATIME
 2

	)

233 
	#S_APPEND
 4

	)

234 
	#S_IMMUTABLE
 8

	)

235 
	#S_DEAD
 16

	)

236 
	#S_NOQUOTA
 32

	)

237 
	#S_DIRSYNC
 64

	)

238 
	#S_NOCMTIME
 128

	)

239 
	#S_SWAPFILE
 256

	)

240 
	#S_PRIVATE
 512

	)

241 
	#S_IMA
 1024

	)

242 
	#S_AUTOMOUNT
 2048

	)

243 
	#S_NOSEC
 4096

	)

258 
	#__IS_FLG
(
öode
,
Êg
Ë((öode)->
i_sb
->
s_Êags
 & (Êg))

	)

260 
	#IS_RDONLY
(
öode
Ë((öode)->
i_sb
->
s_Êags
 & 
MS_RDONLY
)

	)

261 
	#IS_SYNC
(
öode
Ë(
	`__IS_FLG
(öode, 
MS_SYNCHRONOUS
) || \

262 ((
öode
)->
i_Êags
 & 
S_SYNC
))

	)

263 
	#IS_DIRSYNC
(
öode
Ë(
	`__IS_FLG
(öode, 
MS_SYNCHRONOUS
|
MS_DIRSYNC
) || \

264 ((
öode
)->
i_Êags
 & (
S_SYNC
|
S_DIRSYNC
)))

	)

265 
	#IS_MANDLOCK
(
öode
Ë
	`__IS_FLG
(öode, 
MS_MANDLOCK
)

	)

266 
	#IS_NOATIME
(
öode
Ë
	`__IS_FLG
(öode, 
MS_RDONLY
|
MS_NOATIME
)

	)

267 
	#IS_I_VERSION
(
öode
Ë
	`__IS_FLG
(öode, 
MS_I_VERSION
)

	)

269 
	#IS_NOQUOTA
(
öode
Ë((öode)->
i_Êags
 & 
S_NOQUOTA
)

	)

270 
	#IS_APPEND
(
öode
Ë((öode)->
i_Êags
 & 
S_APPEND
)

	)

271 
	#IS_IMMUTABLE
(
öode
Ë((öode)->
i_Êags
 & 
S_IMMUTABLE
)

	)

272 
	#IS_POSIXACL
(
öode
Ë
	`__IS_FLG
(öode, 
MS_POSIXACL
)

	)

274 
	#IS_DEADDIR
(
öode
Ë((öode)->
i_Êags
 & 
S_DEAD
)

	)

275 
	#IS_NOCMTIME
(
öode
Ë((öode)->
i_Êags
 & 
S_NOCMTIME
)

	)

276 
	#IS_SWAPFILE
(
öode
Ë((öode)->
i_Êags
 & 
S_SWAPFILE
)

	)

277 
	#IS_PRIVATE
(
öode
Ë((öode)->
i_Êags
 & 
S_PRIVATE
)

	)

278 
	#IS_IMA
(
öode
Ë((öode)->
i_Êags
 & 
S_IMA
)

	)

279 
	#IS_AUTOMOUNT
(
öode
Ë((öode)->
i_Êags
 & 
S_AUTOMOUNT
)

	)

280 
	#IS_NOSEC
(
öode
Ë((öode)->
i_Êags
 & 
S_NOSEC
)

	)

285 
	#BLKROSET
 
	`_IO
(0x12,93Ë

	)

286 
	#BLKROGET
 
	`_IO
(0x12,94Ë

	)

287 
	#BLKRRPART
 
	`_IO
(0x12,95Ë

	)

288 
	#BLKGETSIZE
 
	`_IO
(0x12,96Ë

	)

289 
	#BLKFLSBUF
 
	`_IO
(0x12,97Ë

	)

290 
	#BLKRASET
 
	`_IO
(0x12,98Ë

	)

291 
	#BLKRAGET
 
	`_IO
(0x12,99Ë

	)

292 
	#BLKFRASET
 
	`_IO
(0x12,100)

	)

293 
	#BLKFRAGET
 
	`_IO
(0x12,101)

	)

294 
	#BLKSECTSET
 
	`_IO
(0x12,102)

	)

295 
	#BLKSECTGET
 
	`_IO
(0x12,103)

	)

296 
	#BLKSSZGET
 
	`_IO
(0x12,104)

	)

298 
	#BLKPG
 
	`_IO
(0x12,105)

	)

302 
	#BLKELVGET
 
	`_IOR
(0x12,106,
size_t
)

	)

303 
	#BLKELVSET
 
	`_IOW
(0x12,107,
size_t
)

	)

308 
	#BLKBSZGET
 
	`_IOR
(0x12,112,
size_t
)

	)

309 
	#BLKBSZSET
 
	`_IOW
(0x12,113,
size_t
)

	)

310 
	#BLKGETSIZE64
 
	`_IOR
(0x12,114,
size_t
Ë

	)

311 
	#BLKTRACESETUP
 
	`_IOWR
(0x12,115,
blk_u£r_åa˚_£tup
)

	)

312 
	#BLKTRACESTART
 
	`_IO
(0x12,116)

	)

313 
	#BLKTRACESTOP
 
	`_IO
(0x12,117)

	)

314 
	#BLKTRACETEARDOWN
 
	`_IO
(0x12,118)

	)

315 
	#BLKDISCARD
 
	`_IO
(0x12,119)

	)

316 
	#BLKIOMIN
 
	`_IO
(0x12,120)

	)

317 
	#BLKIOOPT
 
	`_IO
(0x12,121)

	)

318 
	#BLKALIGNOFF
 
	`_IO
(0x12,122)

	)

319 
	#BLKPBSZGET
 
	`_IO
(0x12,123)

	)

320 
	#BLKDISCARDZEROES
 
	`_IO
(0x12,124)

	)

321 
	#BLKSECDISCARD
 
	`_IO
(0x12,125)

	)

323 
	#BMAP_IOCTL
 1

	)

324 
	#FIBMAP
 
	`_IO
(0x00,1Ë

	)

325 
	#FIGETBSZ
 
	`_IO
(0x00,2Ë

	)

326 
	#FIFREEZE
 
	`_IOWR
('X', 119, Ë

	)

327 
	#FITHAW
 
	`_IOWR
('X', 120, Ë

	)

328 
	#FITRIM
 
	`_IOWR
('X', 121, 
f°rim_ønge
Ë

	)

330 
	#FS_IOC_GETFLAGS
 
	`_IOR
('f', 1, )

	)

331 
	#FS_IOC_SETFLAGS
 
	`_IOW
('f', 2, )

	)

332 
	#FS_IOC_GETVERSION
 
	`_IOR
('v', 1, )

	)

333 
	#FS_IOC_SETVERSION
 
	`_IOW
('v', 2, )

	)

334 
	#FS_IOC_FIEMAP
 
	`_IOWR
('f', 11, 
fõm≠
)

	)

335 
	#FS_IOC32_GETFLAGS
 
	`_IOR
('f', 1, )

	)

336 
	#FS_IOC32_SETFLAGS
 
	`_IOW
('f', 2, )

	)

337 
	#FS_IOC32_GETVERSION
 
	`_IOR
('v', 1, )

	)

338 
	#FS_IOC32_SETVERSION
 
	`_IOW
('v', 2, )

	)

343 
	#FS_SECRM_FL
 0x00000001

	)

344 
	#FS_UNRM_FL
 0x00000002

	)

345 
	#FS_COMPR_FL
 0x00000004

	)

346 
	#FS_SYNC_FL
 0x00000008

	)

347 
	#FS_IMMUTABLE_FL
 0x00000010

	)

348 
	#FS_APPEND_FL
 0x00000020

	)

349 
	#FS_NODUMP_FL
 0x00000040

	)

350 
	#FS_NOATIME_FL
 0x00000080

	)

352 
	#FS_DIRTY_FL
 0x00000100

	)

353 
	#FS_COMPRBLK_FL
 0x00000200

	)

354 
	#FS_NOCOMP_FL
 0x00000400

	)

355 
	#FS_ECOMPR_FL
 0x00000800

	)

357 
	#FS_BTREE_FL
 0x00001000

	)

358 
	#FS_INDEX_FL
 0x00001000

	)

359 
	#FS_IMAGIC_FL
 0x00002000

	)

360 
	#FS_JOURNAL_DATA_FL
 0x00004000

	)

361 
	#FS_NOTAIL_FL
 0x00008000

	)

362 
	#FS_DIRSYNC_FL
 0x00010000

	)

363 
	#FS_TOPDIR_FL
 0x00020000

	)

364 
	#FS_EXTENT_FL
 0x00080000

	)

365 
	#FS_DIRECTIO_FL
 0x00100000

	)

366 
	#FS_NOCOW_FL
 0x00800000

	)

367 
	#FS_RESERVED_FL
 0x80000000

	)

369 
	#FS_FL_USER_VISIBLE
 0x0003DFFF

	)

370 
	#FS_FL_USER_MODIFIABLE
 0x000380FF

	)

373 
	#SYNC_FILE_RANGE_WAIT_BEFORE
 1

	)

374 
	#SYNC_FILE_RANGE_WRITE
 2

	)

375 
	#SYNC_FILE_RANGE_WAIT_AFTER
 4

	)

	@/usr/include/linux/ioctl.h

1 #i‚de‡
_LINUX_IOCTL_H


2 
	#_LINUX_IOCTL_H


	)

4 
	~<asm/io˘l.h
>

	@/usr/include/linux/kernel.h

1 #i‚de‡
_LINUX_KERNEL_H


2 
	#_LINUX_KERNEL_H


	)

7 
	#__ALIGN_KERNEL
(
x
, 
a
Ë
	`__ALIGN_KERNEL_MASK
(x, (
	`ty≥of
(x))◊Ë- 1)

	)

8 
	#__ALIGN_KERNEL_MASK
(
x
, 
mask
Ë(((xË+ (mask)Ë& ~(mask))

	)

11 
	#SI_LOAD_SHIFT
 16

	)

12 
	ssysöfo
 {

13 
	mu±ime
;

14 
	mlﬂds
[3];

15 
	mtŸÆøm
;

16 
	m‰ìøm
;

17 
	msh¨edøm
;

18 
	mbuf„ºam
;

19 
	mtŸÆsw≠
;

20 
	m‰ìsw≠
;

21 
	m¥ocs
;

22 
	m∑d
;

23 
	mtŸÆhigh
;

24 
	m‰ìhigh
;

25 
	mmem_unô
;

26 
	m_f
[20-2*()-()];

	@/usr/include/linux/poll.h

1 #i‚de‡
_LINUX_POLL_H


2 
	#_LINUX_POLL_H


	)

4 
	~<asm/pﬁl.h
>

	@/usr/include/linux/tty.h

1 #i‚de‡
_LINUX_TTY_H


2 
	#_LINUX_TTY_H


	)

8 
	#NR_LDISCS
 30

	)

11 
	#N_TTY
 0

	)

12 
	#N_SLIP
 1

	)

13 
	#N_MOUSE
 2

	)

14 
	#N_PPP
 3

	)

15 
	#N_STRIP
 4

	)

16 
	#N_AX25
 5

	)

17 
	#N_X25
 6

	)

18 
	#N_6PACK
 7

	)

19 
	#N_MASC
 8

	)

20 
	#N_R3964
 9

	)

21 
	#N_PROFIBUS_FDL
 10

	)

22 
	#N_IRDA
 11

	)

23 
	#N_SMSBLOCK
 12

	)

25 
	#N_HDLC
 13

	)

26 
	#N_SYNC_PPP
 14

	)

27 
	#N_HCI
 15

	)

28 
	#N_GIGASET_M101
 16

	)

29 
	#N_SLCAN
 17

	)

30 
	#N_PPS
 18

	)

31 
	#N_V253
 19

	)

32 
	#N_CAIF
 20

	)

33 
	#N_GSM0710
 21

	)

34 
	#N_TI_WL
 22

	)

35 
	#N_TRACESINK
 23

	)

36 
	#N_TRACEROUTER
 24

	)

	@/usr/include/linux/types.h

1 #i‚de‡
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

4 
	~<asm/ty≥s.h
>

6 #i‚de‡
__ASSEMBLY__


8 
	~<löux/posix_ty≥s.h
>

16 #ifde‡
__CHECKER__


17 
	#__bôwi£__
 
	`__©åibuã__
((
bôwi£
))

	)

19 
	#__bôwi£__


	)

21 #ifde‡
__CHECK_ENDIAN__


22 
	#__bôwi£
 
__bôwi£__


	)

24 
	#__bôwi£


	)

27 
__u16
 
	t__bôwi£
 
	t__À16
;

28 
__u16
 
	t__bôwi£
 
	t__be16
;

29 
__u32
 
	t__bôwi£
 
	t__À32
;

30 
__u32
 
	t__bôwi£
 
	t__be32
;

31 
__u64
 
	t__bôwi£
 
	t__À64
;

32 
__u64
 
	t__bôwi£
 
	t__be64
;

34 
__u16
 
	t__bôwi£
 
	t__sum16
;

35 
__u32
 
	t__bôwi£
 
	t__wsum
;

46 
	#__Æig√d_u64
 
__u64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

47 
	#__Æig√d_be64
 
__be64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

48 
	#__Æig√d_À64
 
__À64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

	@/usr/include/asm/errno.h

1 
	~<asm-gíîic/î∫o.h
>

	@/usr/include/asm/fcntl.h

1 
	~<asm-gíîic/f˙é.h
>

	@/usr/include/asm/ioctl.h

1 
	~<asm-gíîic/io˘l.h
>

	@/usr/include/asm/poll.h

1 
	~<asm-gíîic/pﬁl.h
>

	@/usr/include/asm/types.h

1 #i‚de‡
_ASM_X86_TYPES_H


2 
	#_ASM_X86_TYPES_H


	)

4 
	~<asm-gíîic/ty≥s.h
>

	@/usr/include/linux/blk_types.h

5 #i‚de‡
__LINUX_BLK_TYPES_H


6 
	#__LINUX_BLK_TYPES_H


	)

8 #ifde‡
CONFIG_BLOCK


10 
	~<löux/ty≥s.h
>

12 
	gbio_£t
;

13 
	gbio
;

14 
	gbio_öãgrôy_∑ylﬂd
;

15 
	g∑ge
;

16 
	gblock_devi˚
;

17 (
	tbio_íd_io_t
Ë(
	tbio
 *, );

18 (
	tbio_de°ru˘‹_t
Ë(
	tbio
 *);

23 
	sbio_vec
 {

24 
∑ge
 *
bv_∑ge
;

25 
bv_Àn
;

26 
bv_off£t
;

33 
	sbio
 {

34 
£˘‹_t
 
bi_£˘‹
;

36 
bio
 *
bi_√xt
;

37 
block_devi˚
 *
bi_bdev
;

38 
bi_Êags
;

39 
bi_rw
;

43 
bi_v˙t
;

44 
bi_idx
;

49 
bi_phys_£gmíts
;

51 
bi_size
;

57 
bi_£g_‰⁄t_size
;

58 
bi_£g_back_size
;

60 
bi_max_vecs
;

62 
©omic_t
 
bi_˙t
;

64 
bio_vec
 *
bi_io_vec
;

66 
bio_íd_io_t
 *
bi_íd_io
;

68 *
bi_¥iv©e
;

69 #i‡
	`deföed
(
CONFIG_BLK_DEV_INTEGRITY
)

70 
bio_öãgrôy_∑ylﬂd
 *
bi_öãgrôy
;

73 
bio_de°ru˘‹_t
 *
bi_de°ru˘‹
;

80 
bio_vec
 
bi_ölöe_vecs
[0];

86 
	#BIO_UPTODATE
 0

	)

87 
	#BIO_RW_BLOCK
 1

	)

88 
	#BIO_EOF
 2

	)

89 
	#BIO_SEG_VALID
 3

	)

90 
	#BIO_CLONED
 4

	)

91 
	#BIO_BOUNCED
 5

	)

92 
	#BIO_USER_MAPPED
 6

	)

93 
	#BIO_EOPNOTSUPP
 7

	)

94 
	#BIO_NULL_MAPPED
 8

	)

95 
	#BIO_FS_INTEGRITY
 9

	)

96 
	#BIO_QUIET
 10

	)

97 
	#BIO_MAPPED_INTEGRITY
 11

	)

98 
	#bio_Êagged
(
bio
, 
Êag
Ë((bio)->
bi_Êags
 & (1 << (Êag)))

	)

103 
	#BIO_POOL_BITS
 (4)

	)

104 
	#BIO_POOL_NONE
 ((1UL << 
BIO_POOL_BITS
Ë- 1)

	)

105 
	#BIO_POOL_OFFSET
 (
BITS_PER_LONG
 - 
BIO_POOL_BITS
)

	)

106 
	#BIO_POOL_MASK
 (1UL << 
BIO_POOL_OFFSET
)

	)

107 
	#BIO_POOL_IDX
(
bio
Ë((bio)->
bi_Êags
 >> 
BIO_POOL_OFFSET
)

	)

115 
	erq_Êag_bôs
 {

117 
__REQ_WRITE
,

118 
__REQ_FAILFAST_DEV
,

119 
__REQ_FAILFAST_TRANSPORT
,

120 
__REQ_FAILFAST_DRIVER
,

122 
__REQ_SYNC
,

123 
__REQ_META
,

124 
__REQ_PRIO
,

125 
__REQ_DISCARD
,

126 
__REQ_SECURE
,

128 
__REQ_NOIDLE
,

129 
__REQ_FUA
,

130 
__REQ_FLUSH
,

133 
__REQ_RAHEAD
,

134 
__REQ_THROTTLED
,

138 
__REQ_SORTED
,

139 
__REQ_SOFTBARRIER
,

140 
__REQ_NOMERGE
,

141 
__REQ_STARTED
,

142 
__REQ_DONTPREP
,

143 
__REQ_QUEUED
,

144 
__REQ_ELVPRIV
,

145 
__REQ_FAILED
,

146 
__REQ_QUIET
,

147 
__REQ_PREEMPT
,

148 
__REQ_ALLOCED
,

149 
__REQ_COPY_USER
,

150 
__REQ_FLUSH_SEQ
,

151 
__REQ_IO_STAT
,

152 
__REQ_MIXED_MERGE
,

153 
__REQ_NR_BITS
,

156 
	#REQ_WRITE
 (1 << 
__REQ_WRITE
)

	)

157 
	#REQ_FAILFAST_DEV
 (1 << 
__REQ_FAILFAST_DEV
)

	)

158 
	#REQ_FAILFAST_TRANSPORT
 (1 << 
__REQ_FAILFAST_TRANSPORT
)

	)

159 
	#REQ_FAILFAST_DRIVER
 (1 << 
__REQ_FAILFAST_DRIVER
)

	)

160 
	#REQ_SYNC
 (1 << 
__REQ_SYNC
)

	)

161 
	#REQ_META
 (1 << 
__REQ_META
)

	)

162 
	#REQ_PRIO
 (1 << 
__REQ_PRIO
)

	)

163 
	#REQ_DISCARD
 (1 << 
__REQ_DISCARD
)

	)

164 
	#REQ_NOIDLE
 (1 << 
__REQ_NOIDLE
)

	)

166 
	#REQ_FAILFAST_MASK
 \

167 (
REQ_FAILFAST_DEV
 | 
REQ_FAILFAST_TRANSPORT
 | 
REQ_FAILFAST_DRIVER
)

	)

168 
	#REQ_COMMON_MASK
 \

169 (
REQ_WRITE
 | 
REQ_FAILFAST_MASK
 | 
REQ_SYNC
 | 
REQ_META
 | 
REQ_PRIO
 | \

170 
REQ_DISCARD
 | 
REQ_NOIDLE
 | 
REQ_FLUSH
 | 
REQ_FUA
 | 
REQ_SECURE
)

	)

171 
	#REQ_CLONE_MASK
 
REQ_COMMON_MASK


	)

173 
	#REQ_RAHEAD
 (1 << 
__REQ_RAHEAD
)

	)

174 
	#REQ_THROTTLED
 (1 << 
__REQ_THROTTLED
)

	)

176 
	#REQ_SORTED
 (1 << 
__REQ_SORTED
)

	)

177 
	#REQ_SOFTBARRIER
 (1 << 
__REQ_SOFTBARRIER
)

	)

178 
	#REQ_FUA
 (1 << 
__REQ_FUA
)

	)

179 
	#REQ_NOMERGE
 (1 << 
__REQ_NOMERGE
)

	)

180 
	#REQ_STARTED
 (1 << 
__REQ_STARTED
)

	)

181 
	#REQ_DONTPREP
 (1 << 
__REQ_DONTPREP
)

	)

182 
	#REQ_QUEUED
 (1 << 
__REQ_QUEUED
)

	)

183 
	#REQ_ELVPRIV
 (1 << 
__REQ_ELVPRIV
)

	)

184 
	#REQ_FAILED
 (1 << 
__REQ_FAILED
)

	)

185 
	#REQ_QUIET
 (1 << 
__REQ_QUIET
)

	)

186 
	#REQ_PREEMPT
 (1 << 
__REQ_PREEMPT
)

	)

187 
	#REQ_ALLOCED
 (1 << 
__REQ_ALLOCED
)

	)

188 
	#REQ_COPY_USER
 (1 << 
__REQ_COPY_USER
)

	)

189 
	#REQ_FLUSH
 (1 << 
__REQ_FLUSH
)

	)

190 
	#REQ_FLUSH_SEQ
 (1 << 
__REQ_FLUSH_SEQ
)

	)

191 
	#REQ_IO_STAT
 (1 << 
__REQ_IO_STAT
)

	)

192 
	#REQ_MIXED_MERGE
 (1 << 
__REQ_MIXED_MERGE
)

	)

193 
	#REQ_SECURE
 (1 << 
__REQ_SECURE
)

	)

	@/usr/include/linux/limits.h

1 #i‚de‡
_LINUX_LIMITS_H


2 
	#_LINUX_LIMITS_H


	)

4 
	#NR_OPEN
 1024

	)

6 
	#NGROUPS_MAX
 65536

	)

7 
	#ARG_MAX
 131072

	)

8 
	#LINK_MAX
 127

	)

9 
	#MAX_CANON
 255

	)

10 
	#MAX_INPUT
 255

	)

11 
	#NAME_MAX
 255

	)

12 
	#PATH_MAX
 4096

	)

13 
	#PIPE_BUF
 4096

	)

14 
	#XATTR_NAME_MAX
 255

	)

15 
	#XATTR_SIZE_MAX
 65536

	)

16 
	#XATTR_LIST_MAX
 65536

	)

18 
	#RTSIG_MAX
 32

	)

	@/usr/include/linux/posix_types.h

1 #i‚de‡
_LINUX_POSIX_TYPES_H


2 
	#_LINUX_POSIX_TYPES_H


	)

4 
	~<löux/°ddef.h
>

21 #unde‡
__NFDBITS


22 
	#__NFDBITS
 (8 * ())

	)

24 #unde‡
__FD_SETSIZE


25 
	#__FD_SETSIZE
 1024

	)

27 #unde‡
__FDSET_LONGS


28 
	#__FDSET_LONGS
 (
__FD_SETSIZE
/
__NFDBITS
)

	)

30 #unde‡
__FDELT


31 
	#__FDELT
(
d
Ë((dË/ 
__NFDBITS
)

	)

33 #unde‡
__FDMASK


34 
	#__FDMASK
(
d
Ë(1UL << ((dË% 
__NFDBITS
))

	)

37 
	mfds_bôs
 [
__FDSET_LONGS
];

38 } 
	t__kî√l_fd_£t
;

41 (*
	t__kî√l_sigh™dÀr_t
)();

44 
	t__kî√l_key_t
;

45 
	t__kî√l_mqd_t
;

47 
	~<asm/posix_ty≥s.h
>

	@/usr/include/asm-generic/errno.h

1 #i‚de‡
_ASM_GENERIC_ERRNO_H


2 
	#_ASM_GENERIC_ERRNO_H


	)

4 
	~<asm-gíîic/î∫o-ba£.h
>

6 
	#EDEADLK
 35

	)

7 
	#ENAMETOOLONG
 36

	)

8 
	#ENOLCK
 37

	)

9 
	#ENOSYS
 38

	)

10 
	#ENOTEMPTY
 39

	)

11 
	#ELOOP
 40

	)

12 
	#EWOULDBLOCK
 
EAGAIN


	)

13 
	#ENOMSG
 42

	)

14 
	#EIDRM
 43

	)

15 
	#ECHRNG
 44

	)

16 
	#EL2NSYNC
 45

	)

17 
	#EL3HLT
 46

	)

18 
	#EL3RST
 47

	)

19 
	#ELNRNG
 48

	)

20 
	#EUNATCH
 49

	)

21 
	#ENOCSI
 50

	)

22 
	#EL2HLT
 51

	)

23 
	#EBADE
 52

	)

24 
	#EBADR
 53

	)

25 
	#EXFULL
 54

	)

26 
	#ENOANO
 55

	)

27 
	#EBADRQC
 56

	)

28 
	#EBADSLT
 57

	)

30 
	#EDEADLOCK
 
EDEADLK


	)

32 
	#EBFONT
 59

	)

33 
	#ENOSTR
 60

	)

34 
	#ENODATA
 61

	)

35 
	#ETIME
 62

	)

36 
	#ENOSR
 63

	)

37 
	#ENONET
 64

	)

38 
	#ENOPKG
 65

	)

39 
	#EREMOTE
 66

	)

40 
	#ENOLINK
 67

	)

41 
	#EADV
 68

	)

42 
	#ESRMNT
 69

	)

43 
	#ECOMM
 70

	)

44 
	#EPROTO
 71

	)

45 
	#EMULTIHOP
 72

	)

46 
	#EDOTDOT
 73

	)

47 
	#EBADMSG
 74

	)

48 
	#EOVERFLOW
 75

	)

49 
	#ENOTUNIQ
 76

	)

50 
	#EBADFD
 77

	)

51 
	#EREMCHG
 78

	)

52 
	#ELIBACC
 79

	)

53 
	#ELIBBAD
 80

	)

54 
	#ELIBSCN
 81

	)

55 
	#ELIBMAX
 82

	)

56 
	#ELIBEXEC
 83

	)

57 
	#EILSEQ
 84

	)

58 
	#ERESTART
 85

	)

59 
	#ESTRPIPE
 86

	)

60 
	#EUSERS
 87

	)

61 
	#ENOTSOCK
 88

	)

62 
	#EDESTADDRREQ
 89

	)

63 
	#EMSGSIZE
 90

	)

64 
	#EPROTOTYPE
 91

	)

65 
	#ENOPROTOOPT
 92

	)

66 
	#EPROTONOSUPPORT
 93

	)

67 
	#ESOCKTNOSUPPORT
 94

	)

68 
	#EOPNOTSUPP
 95

	)

69 
	#EPFNOSUPPORT
 96

	)

70 
	#EAFNOSUPPORT
 97

	)

71 
	#EADDRINUSE
 98

	)

72 
	#EADDRNOTAVAIL
 99

	)

73 
	#ENETDOWN
 100

	)

74 
	#ENETUNREACH
 101

	)

75 
	#ENETRESET
 102

	)

76 
	#ECONNABORTED
 103

	)

77 
	#ECONNRESET
 104

	)

78 
	#ENOBUFS
 105

	)

79 
	#EISCONN
 106

	)

80 
	#ENOTCONN
 107

	)

81 
	#ESHUTDOWN
 108

	)

82 
	#ETOOMANYREFS
 109

	)

83 
	#ETIMEDOUT
 110

	)

84 
	#ECONNREFUSED
 111

	)

85 
	#EHOSTDOWN
 112

	)

86 
	#EHOSTUNREACH
 113

	)

87 
	#EALREADY
 114

	)

88 
	#EINPROGRESS
 115

	)

89 
	#ESTALE
 116

	)

90 
	#EUCLEAN
 117

	)

91 
	#ENOTNAM
 118

	)

92 
	#ENAVAIL
 119

	)

93 
	#EISNAM
 120

	)

94 
	#EREMOTEIO
 121

	)

95 
	#EDQUOT
 122

	)

97 
	#ENOMEDIUM
 123

	)

98 
	#EMEDIUMTYPE
 124

	)

99 
	#ECANCELED
 125

	)

100 
	#ENOKEY
 126

	)

101 
	#EKEYEXPIRED
 127

	)

102 
	#EKEYREVOKED
 128

	)

103 
	#EKEYREJECTED
 129

	)

106 
	#EOWNERDEAD
 130

	)

107 
	#ENOTRECOVERABLE
 131

	)

109 
	#ERFKILL
 132

	)

111 
	#EHWPOISON
 133

	)

	@/usr/include/asm-generic/fcntl.h

1 #i‚de‡
_ASM_GENERIC_FCNTL_H


2 
	#_ASM_GENERIC_FCNTL_H


	)

4 
	~<löux/ty≥s.h
>

18 
	#O_ACCMODE
 00000003

	)

19 
	#O_RDONLY
 00000000

	)

20 
	#O_WRONLY
 00000001

	)

21 
	#O_RDWR
 00000002

	)

22 #i‚de‡
O_CREAT


23 
	#O_CREAT
 00000100

	)

25 #i‚de‡
O_EXCL


26 
	#O_EXCL
 00000200

	)

28 #i‚de‡
O_NOCTTY


29 
	#O_NOCTTY
 00000400

	)

31 #i‚de‡
O_TRUNC


32 
	#O_TRUNC
 00001000

	)

34 #i‚de‡
O_APPEND


35 
	#O_APPEND
 00002000

	)

37 #i‚de‡
O_NONBLOCK


38 
	#O_NONBLOCK
 00004000

	)

40 #i‚de‡
O_DSYNC


41 
	#O_DSYNC
 00010000

	)

43 #i‚de‡
FASYNC


44 
	#FASYNC
 00020000

	)

46 #i‚de‡
O_DIRECT


47 
	#O_DIRECT
 00040000

	)

49 #i‚de‡
O_LARGEFILE


50 
	#O_LARGEFILE
 00100000

	)

52 #i‚de‡
O_DIRECTORY


53 
	#O_DIRECTORY
 00200000

	)

55 #i‚de‡
O_NOFOLLOW


56 
	#O_NOFOLLOW
 00400000

	)

58 #i‚de‡
O_NOATIME


59 
	#O_NOATIME
 01000000

	)

61 #i‚de‡
O_CLOEXEC


62 
	#O_CLOEXEC
 02000000

	)

78 #i‚de‡
O_SYNC


79 
	#__O_SYNC
 04000000

	)

80 
	#O_SYNC
 (
__O_SYNC
|
O_DSYNC
)

	)

83 #i‚de‡
O_PATH


84 
	#O_PATH
 010000000

	)

87 #i‚de‡
O_NDELAY


88 
	#O_NDELAY
 
O_NONBLOCK


	)

91 
	#F_DUPFD
 0

	)

92 
	#F_GETFD
 1

	)

93 
	#F_SETFD
 2

	)

94 
	#F_GETFL
 3

	)

95 
	#F_SETFL
 4

	)

96 #i‚de‡
F_GETLK


97 
	#F_GETLK
 5

	)

98 
	#F_SETLK
 6

	)

99 
	#F_SETLKW
 7

	)

101 #i‚de‡
F_SETOWN


102 
	#F_SETOWN
 8

	)

103 
	#F_GETOWN
 9

	)

105 #i‚de‡
F_SETSIG


106 
	#F_SETSIG
 10

	)

107 
	#F_GETSIG
 11

	)

110 #i‚de‡
CONFIG_64BIT


111 #i‚de‡
F_GETLK64


112 
	#F_GETLK64
 12

	)

113 
	#F_SETLK64
 13

	)

114 
	#F_SETLKW64
 14

	)

118 #i‚de‡
F_SETOWN_EX


119 
	#F_SETOWN_EX
 15

	)

120 
	#F_GETOWN_EX
 16

	)

123 
	#F_OWNER_TID
 0

	)

124 
	#F_OWNER_PID
 1

	)

125 
	#F_OWNER_PGRP
 2

	)

127 
	sf_ow√r_ex
 {

128 
	mty≥
;

129 
__kî√l_pid_t
 
	mpid
;

133 
	#FD_CLOEXEC
 1

	)

136 #i‚de‡
F_RDLCK


137 
	#F_RDLCK
 0

	)

138 
	#F_WRLCK
 1

	)

139 
	#F_UNLCK
 2

	)

143 #i‚de‡
F_EXLCK


144 
	#F_EXLCK
 4

	)

145 
	#F_SHLCK
 8

	)

149 
	#LOCK_SH
 1

	)

150 
	#LOCK_EX
 2

	)

151 
	#LOCK_NB
 4

	)

153 
	#LOCK_UN
 8

	)

155 
	#LOCK_MAND
 32

	)

156 
	#LOCK_READ
 64

	)

157 
	#LOCK_WRITE
 128

	)

158 
	#LOCK_RW
 192

	)

160 
	#F_LINUX_SPECIFIC_BASE
 1024

	)

162 #i‚de‡
HAVE_ARCH_STRUCT_FLOCK


163 #i‚de‡
__ARCH_FLOCK_PAD


164 
	#__ARCH_FLOCK_PAD


	)

167 
	sÊock
 {

168 
	ml_ty≥
;

169 
	ml_whí˚
;

170 
__kî√l_off_t
 
	ml_°¨t
;

171 
__kî√l_off_t
 
	ml_Àn
;

172 
__kî√l_pid_t
 
	ml_pid
;

173 
	m__ARCH_FLOCK_PAD


177 #i‚de‡
CONFIG_64BIT


179 #i‚de‡
HAVE_ARCH_STRUCT_FLOCK64


180 #i‚de‡
__ARCH_FLOCK64_PAD


181 
	#__ARCH_FLOCK64_PAD


	)

184 
	sÊock64
 {

185 
	ml_ty≥
;

186 
	ml_whí˚
;

187 
__kî√l_loff_t
 
	ml_°¨t
;

188 
__kî√l_loff_t
 
	ml_Àn
;

189 
__kî√l_pid_t
 
	ml_pid
;

190 
	m__ARCH_FLOCK64_PAD


	@/usr/include/asm-generic/ioctl.h

1 #i‚de‡
_ASM_GENERIC_IOCTL_H


2 
	#_ASM_GENERIC_IOCTL_H


	)

22 
	#_IOC_NRBITS
 8

	)

23 
	#_IOC_TYPEBITS
 8

	)

30 #i‚de‡
_IOC_SIZEBITS


31 
	#_IOC_SIZEBITS
 14

	)

34 #i‚de‡
_IOC_DIRBITS


35 
	#_IOC_DIRBITS
 2

	)

38 
	#_IOC_NRMASK
 ((1 << 
_IOC_NRBITS
)-1)

	)

39 
	#_IOC_TYPEMASK
 ((1 << 
_IOC_TYPEBITS
)-1)

	)

40 
	#_IOC_SIZEMASK
 ((1 << 
_IOC_SIZEBITS
)-1)

	)

41 
	#_IOC_DIRMASK
 ((1 << 
_IOC_DIRBITS
)-1)

	)

43 
	#_IOC_NRSHIFT
 0

	)

44 
	#_IOC_TYPESHIFT
 (
_IOC_NRSHIFT
+
_IOC_NRBITS
)

	)

45 
	#_IOC_SIZESHIFT
 (
_IOC_TYPESHIFT
+
_IOC_TYPEBITS
)

	)

46 
	#_IOC_DIRSHIFT
 (
_IOC_SIZESHIFT
+
_IOC_SIZEBITS
)

	)

53 #i‚de‡
_IOC_NONE


54 
	#_IOC_NONE
 0U

	)

57 #i‚de‡
_IOC_WRITE


58 
	#_IOC_WRITE
 1U

	)

61 #i‚de‡
_IOC_READ


62 
	#_IOC_READ
 2U

	)

65 
	#_IOC
(
dú
,
ty≥
,
ƒ
,
size
) \

66 (((
dú
Ë<< 
_IOC_DIRSHIFT
) | \

67 ((
ty≥
Ë<< 
_IOC_TYPESHIFT
) | \

68 ((
ƒ
Ë<< 
_IOC_NRSHIFT
) | \

69 ((
size
Ë<< 
_IOC_SIZESHIFT
))

	)

71 
	#_IOC_TYPECHECK
(
t
Ë(—))

	)

74 
	#_IO
(
ty≥
,
ƒ
Ë
	`_IOC
(
_IOC_NONE
,—y≥),“r),0)

	)

75 
	#_IOR
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

76 
	#_IOW
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_WRITE
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

77 
	#_IOWR
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

78 
	#_IOR_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
,—y≥),“r),(size))

	)

79 
	#_IOW_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_WRITE
,—y≥),“r),(size))

	)

80 
	#_IOWR_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,—y≥),“r),(size))

	)

83 
	#_IOC_DIR
(
ƒ
Ë((“rË>> 
_IOC_DIRSHIFT
Ë& 
_IOC_DIRMASK
)

	)

84 
	#_IOC_TYPE
(
ƒ
Ë((“rË>> 
_IOC_TYPESHIFT
Ë& 
_IOC_TYPEMASK
)

	)

85 
	#_IOC_NR
(
ƒ
Ë((“rË>> 
_IOC_NRSHIFT
Ë& 
_IOC_NRMASK
)

	)

86 
	#_IOC_SIZE
(
ƒ
Ë((“rË>> 
_IOC_SIZESHIFT
Ë& 
_IOC_SIZEMASK
)

	)

90 
	#IOC_IN
 (
_IOC_WRITE
 << 
_IOC_DIRSHIFT
)

	)

91 
	#IOC_OUT
 (
_IOC_READ
 << 
_IOC_DIRSHIFT
)

	)

92 
	#IOC_INOUT
 ((
_IOC_WRITE
|
_IOC_READ
Ë<< 
_IOC_DIRSHIFT
)

	)

93 
	#IOCSIZE_MASK
 (
_IOC_SIZEMASK
 << 
_IOC_SIZESHIFT
)

	)

94 
	#IOCSIZE_SHIFT
 (
_IOC_SIZESHIFT
)

	)

	@/usr/include/asm-generic/poll.h

1 #i‚de‡
__ASM_GENERIC_POLL_H


2 
	#__ASM_GENERIC_POLL_H


	)

5 
	#POLLIN
 0x0001

	)

6 
	#POLLPRI
 0x0002

	)

7 
	#POLLOUT
 0x0004

	)

8 
	#POLLERR
 0x0008

	)

9 
	#POLLHUP
 0x0010

	)

10 
	#POLLNVAL
 0x0020

	)

13 
	#POLLRDNORM
 0x0040

	)

14 
	#POLLRDBAND
 0x0080

	)

15 #i‚de‡
POLLWRNORM


16 
	#POLLWRNORM
 0x0100

	)

18 #i‚de‡
POLLWRBAND


19 
	#POLLWRBAND
 0x0200

	)

21 #i‚de‡
POLLMSG


22 
	#POLLMSG
 0x0400

	)

24 #i‚de‡
POLLREMOVE


25 
	#POLLREMOVE
 0x1000

	)

27 #i‚de‡
POLLRDHUP


28 
	#POLLRDHUP
 0x2000

	)

31 
	#POLLFREE
 0x4000

	)

33 
	spﬁlfd
 {

34 
	mfd
;

35 
	mevíts
;

36 
	mªvíts
;

	@/usr/include/asm-generic/types.h

1 #i‚de‡
_ASM_GENERIC_TYPES_H


2 
	#_ASM_GENERIC_TYPES_H


	)

7 
	~<asm-gíîic/öt-Œ64.h
>

9 #i‚de‡
__ASSEMBLY__


11 
	tumode_t
;

	@/usr/include/asm/posix_types.h

1 #ifde‡
__i386__


2 
	~<asm/posix_ty≥s_32.h
>

4 
	~<asm/posix_ty≥s_64.h
>

	@/usr/include/linux/stddef.h

1 #i‚de‡
_LINUX_STDDEF_H


2 
	#_LINUX_STDDEF_H


	)

6 #unde‡
NULL


7 #i‡
deföed
(
__˝lu•lus
)

8 
	#NULL
 0

	)

10 
	#NULL
 ((*)0)

	)

	@/usr/include/asm-generic/errno-base.h

1 #i‚de‡
_ASM_GENERIC_ERRNO_BASE_H


2 
	#_ASM_GENERIC_ERRNO_BASE_H


	)

4 
	#EPERM
 1

	)

5 
	#ENOENT
 2

	)

6 
	#ESRCH
 3

	)

7 
	#EINTR
 4

	)

8 
	#EIO
 5

	)

9 
	#ENXIO
 6

	)

10 
	#E2BIG
 7

	)

11 
	#ENOEXEC
 8

	)

12 
	#EBADF
 9

	)

13 
	#ECHILD
 10

	)

14 
	#EAGAIN
 11

	)

15 
	#ENOMEM
 12

	)

16 
	#EACCES
 13

	)

17 
	#EFAULT
 14

	)

18 
	#ENOTBLK
 15

	)

19 
	#EBUSY
 16

	)

20 
	#EEXIST
 17

	)

21 
	#EXDEV
 18

	)

22 
	#ENODEV
 19

	)

23 
	#ENOTDIR
 20

	)

24 
	#EISDIR
 21

	)

25 
	#EINVAL
 22

	)

26 
	#ENFILE
 23

	)

27 
	#EMFILE
 24

	)

28 
	#ENOTTY
 25

	)

29 
	#ETXTBSY
 26

	)

30 
	#EFBIG
 27

	)

31 
	#ENOSPC
 28

	)

32 
	#ESPIPE
 29

	)

33 
	#EROFS
 30

	)

34 
	#EMLINK
 31

	)

35 
	#EPIPE
 32

	)

36 
	#EDOM
 33

	)

37 
	#ERANGE
 34

	)

	@/usr/include/asm-generic/int-ll64.h

8 #i‚de‡
_ASM_GENERIC_INT_LL64_H


9 
	#_ASM_GENERIC_INT_LL64_H


	)

11 
	~<asm/bô•îl⁄g.h
>

13 #i‚de‡
__ASSEMBLY__


19 
__sig√d__
 
	t__s8
;

20 
	t__u8
;

22 
__sig√d__
 
	t__s16
;

23 
	t__u16
;

25 
__sig√d__
 
	t__s32
;

26 
	t__u32
;

28 #ifde‡
__GNUC__


29 
__exãnsi⁄__
 
__sig√d__
 
	t__s64
;

30 
__exãnsi⁄__
 
	t__u64
;

32 
__sig√d__
 
	t__s64
;

33 
	t__u64
;

	@/usr/include/asm/posix_types_32.h

1 #i‚de‡
_ASM_X86_POSIX_TYPES_32_H


2 
	#_ASM_X86_POSIX_TYPES_32_H


	)

10 
	t__kî√l_öo_t
;

11 
	t__kî√l_mode_t
;

12 
	t__kî√l_∆ök_t
;

13 
	t__kî√l_off_t
;

14 
	t__kî√l_pid_t
;

15 
	t__kî√l_ùc_pid_t
;

16 
	t__kî√l_uid_t
;

17 
	t__kî√l_gid_t
;

18 
	t__kî√l_size_t
;

19 
	t__kî√l_ssize_t
;

20 
	t__kî√l_±rdiff_t
;

21 
	t__kî√l_time_t
;

22 
	t__kî√l_su£c⁄ds_t
;

23 
	t__kî√l_˛ock_t
;

24 
	t__kî√l_timî_t
;

25 
	t__kî√l_˛ockid_t
;

26 
	t__kî√l_daddr_t
;

27 * 
	t__kî√l_ˇddr_t
;

28 
	t__kî√l_uid16_t
;

29 
	t__kî√l_gid16_t
;

30 
	t__kî√l_uid32_t
;

31 
	t__kî√l_gid32_t
;

33 
	t__kî√l_ﬁd_uid_t
;

34 
	t__kî√l_ﬁd_gid_t
;

35 
	t__kî√l_ﬁd_dev_t
;

37 #ifde‡
__GNUC__


38 
	t__kî√l_loff_t
;

42 
	mvÆ
[2];

43 } 
	t__kî√l_fsid_t
;

	@/usr/include/asm/posix_types_64.h

1 #i‚de‡
_ASM_X86_POSIX_TYPES_64_H


2 
	#_ASM_X86_POSIX_TYPES_64_H


	)

10 
	t__kî√l_öo_t
;

11 
	t__kî√l_mode_t
;

12 
	t__kî√l_∆ök_t
;

13 
	t__kî√l_off_t
;

14 
	t__kî√l_pid_t
;

15 
	t__kî√l_ùc_pid_t
;

16 
	t__kî√l_uid_t
;

17 
	t__kî√l_gid_t
;

18 
	t__kî√l_size_t
;

19 
	t__kî√l_ssize_t
;

20 
	t__kî√l_±rdiff_t
;

21 
	t__kî√l_time_t
;

22 
	t__kî√l_su£c⁄ds_t
;

23 
	t__kî√l_˛ock_t
;

24 
	t__kî√l_timî_t
;

25 
	t__kî√l_˛ockid_t
;

26 
	t__kî√l_daddr_t
;

27 * 
	t__kî√l_ˇddr_t
;

28 
	t__kî√l_uid16_t
;

29 
	t__kî√l_gid16_t
;

31 #ifde‡
__GNUC__


32 
	t__kî√l_loff_t
;

36 
	mvÆ
[2];

37 } 
	t__kî√l_fsid_t
;

39 
	t__kî√l_ﬁd_uid_t
;

40 
	t__kî√l_ﬁd_gid_t
;

41 
__kî√l_uid_t
 
	t__kî√l_uid32_t
;

42 
__kî√l_gid_t
 
	t__kî√l_gid32_t
;

44 
	t__kî√l_ﬁd_dev_t
;

	@/usr/include/asm/bitsperlong.h

1 #i‚de‡
__ASM_X86_BITSPERLONG_H


2 
	#__ASM_X86_BITSPERLONG_H


	)

4 #ifde‡
__x86_64__


5 
	#__BITS_PER_LONG
 64

	)

7 
	#__BITS_PER_LONG
 32

	)

10 
	~<asm-gíîic/bô•îl⁄g.h
>

	@/usr/include/asm-generic/bitsperlong.h

1 #i‚de‡
__ASM_GENERIC_BITS_PER_LONG


2 
	#__ASM_GENERIC_BITS_PER_LONG


	)

11 #i‚de‡
__BITS_PER_LONG


12 
	#__BITS_PER_LONG
 32

	)

	@
1
.
1
/usr/include
33
893
access.c
main.c
pipe.c
scull.h
/usr/include/linux/errno.h
/usr/include/linux/fcntl.h
/usr/include/linux/fs.h
/usr/include/linux/ioctl.h
/usr/include/linux/kernel.h
/usr/include/linux/poll.h
/usr/include/linux/tty.h
/usr/include/linux/types.h
/usr/include/asm/errno.h
/usr/include/asm/fcntl.h
/usr/include/asm/ioctl.h
/usr/include/asm/poll.h
/usr/include/asm/types.h
/usr/include/linux/blk_types.h
/usr/include/linux/limits.h
/usr/include/linux/posix_types.h
/usr/include/asm-generic/errno.h
/usr/include/asm-generic/fcntl.h
/usr/include/asm-generic/ioctl.h
/usr/include/asm-generic/poll.h
/usr/include/asm-generic/types.h
/usr/include/asm/posix_types.h
/usr/include/linux/stddef.h
/usr/include/asm-generic/errno-base.h
/usr/include/asm-generic/int-ll64.h
/usr/include/asm/posix_types_32.h
/usr/include/asm/posix_types_64.h
/usr/include/asm/bitsperlong.h
/usr/include/asm-generic/bitsperlong.h
